<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a1810 0%, #0f2419 50%, #0a1810 100%);
            color: #F9FAFB;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }
        
        /* Mobile touch improvements */
        @media (max-width: 1024px) {
            button, a, input, select, textarea {
                -webkit-tap-highlight-color: rgba(16, 185, 129, 0.2);
                touch-action: manipulation;
            }
            
            /* Larger touch targets on mobile */
            button {
                min-height: 44px;
            }
            
            /* Prevent zoom on input focus */
            input, select, textarea {
                font-size: 16px;
            }
        }
        
        /* Smooth scrolling */
        * {
            -webkit-overflow-scrolling: touch;
        }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f2419; }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(180deg, #10b981, #22c55e);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #059669, #16a34a); }
        
        /* Glass morphism effect */
        .glass {
            background: rgba(15, 36, 25, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(16, 185, 129, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }
        
        /* Animated gradient border */
        @keyframes gradient-border {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .gradient-border {
            position: relative;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(34, 197, 94, 0.1));
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        
        .gradient-border::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: inherit;
            padding: 2px;
            background: linear-gradient(135deg, #10b981, #22c55e, #34d399);
            background-size: 200% 200%;
            animation: gradient-border 3s ease infinite;
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            z-index: -1;
        }
        
        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Pulse animation */
        
        /* Shimmer effect */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        
        /* Smooth transitions */
        button, input, select {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }
        
        button:active {
            transform: translateY(0px);
        }
        
        /* Card hover effect */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
        }
        
        /* Input focus glow */
        input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
        }
        
        /* Progress bar animation */
        .progress-bar {
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Cow animation */
        @keyframes cow-walk {
            0%, 100% { transform: translateX(0) scaleX(1); }
            25% { transform: translateX(10px) scaleX(1); }
            50% { transform: translateX(0) scaleX(-1); }
            75% { transform: translateX(-10px) scaleX(-1); }
        }
        
        .cow-emoji {
            display: inline-block;
            font-size: 3rem;
            animation: cow-walk 4s ease-in-out infinite;
            cursor: pointer;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }
        
        .cow-emoji:hover {
            animation-play-state: paused;
            transform: scale(1.2);
        }
        
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // ============ FIREBASE CONFIGURATION ============
        // TODO: Replace with your actual Firebase config from Firebase Console
        const firebaseConfig = {
            apiKey: "AIzaSyCdHv3rdlgUsD0pacjGDFZtal8WfFiFPaY",
            authDomain: "finance-app-80c2b.firebaseapp.com",
            projectId: "finance-app-80c2b",
            storageBucket: "finance-app-80c2b.firebasestorage.app",
            messagingSenderId: "660016110973",
            appId: "1:660016110973:web:9b641fc94e95ec62fe8014",
            measurementId: "G-XCQJNK7VDD"
            };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ============ UTILITY FUNCTIONS ============
        const calculateDebtPayoff = (balance, annualRate, monthlyPayment, extraPayments = {}, paymentStartDate = null, interestStartDate = null) => {
            let currentBalance = balance;
            let month = 0;
            const maxMonths = 1200; // 100 years safety limit
            const monthlyRate = annualRate / 12 / 100;
            const today = new Date();
            
            while (currentBalance > 0.01 && month < maxMonths) {
                const currentMonth = new Date();
                currentMonth.setMonth(currentMonth.getMonth() + month);
                
                // Check if interest should be applied (for promotional credit cards)
                let interest = 0;
                if (!interestStartDate || new Date(interestStartDate) <= currentMonth) {
                    interest = currentBalance * monthlyRate;
                }
                
                // Check if payments have started (for student loans)
                let payment = 0;
                if (!paymentStartDate || new Date(paymentStartDate) <= currentMonth) {
                    const monthKey = `${currentMonth.getFullYear()}-${currentMonth.getMonth() + 1}`;
                    const extra = extraPayments[monthKey] || 0;
                    payment = monthlyPayment + extra;
                }
                
                currentBalance = currentBalance + interest - payment;
                month++;
                
                if (currentBalance < 0) currentBalance = 0;
            }
            
            return month;
        };

        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        };

        const formatDate = (date) => {
            return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        };

        // ============ AUTH COMPONENT ============
        const Login = ({ onLogin }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                    onLogin();
                } catch (err) {
                    setError(err.message);
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex items-center justify-center px-4 relative overflow-hidden">
                    {/* Animated background elements */}
                    <div className="absolute inset-0 overflow-hidden">
                        <div className="absolute top-20 left-20 w-72 h-72 bg-emerald-500 rounded-full mix-blend-multiply filter blur-xl opacity-20"></div>
                        <div className="absolute top-40 right-20 w-72 h-72 bg-green-500 rounded-full mix-blend-multiply filter blur-xl opacity-20"></div>
                        <div className="absolute bottom-20 left-1/2 w-72 h-72 bg-lime-500 rounded-full mix-blend-multiply filter blur-xl opacity-20"></div>
                    </div>
                    
                    <div className="max-w-md w-full glass rounded-3xl shadow-2xl p-6 md:p-10 relative z-10 float-animation">
                        <div className="text-center mb-8">
                            <div className="inline-block p-4 bg-gradient-to-br from-emerald-500 to-green-600 rounded-2xl mb-4">
                                <svg className="w-10 h-10 md:w-12 md:h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <h2 className="text-3xl md:text-4xl font-bold mb-2">
                                <span className="bg-gradient-to-r from-emerald-400 via-green-400 to-lime-400 bg-clip-text text-transparent">
                                    Finance Tracker
                                </span>
                            </h2>
                            <p className="text-gray-400 text-sm">Manage your finances together</p>
                        </div>
                        
                        <form onSubmit={handleLogin} className="space-y-6">
                            <div>
                                <label className="block text-sm font-semibold mb-2 text-gray-300">Email</label>
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-5 py-3 bg-gray-800/50 border border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent backdrop-blur-sm"
                                    placeholder="your.email@example.com"
                                    required
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-semibold mb-2 text-gray-300">Password</label>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-5 py-3 bg-gray-800/50 border border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent backdrop-blur-sm"
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    required
                                />
                            </div>
                            {error && (
                                <div className="p-3 bg-red-500/10 border border-red-500/50 rounded-xl">
                                    <p className="text-red-400 text-sm">{error}</p>
                                </div>
                            )}
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full py-3 px-4 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                {loading ? (
                                    <span className="flex items-center justify-center gap-2">
                                        <svg className="animate-spin h-5 w-5" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        Logging in...
                                    </span>
                                ) : 'Sign In'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // ============ DASHBOARD COMPONENT ============
        const Dashboard = ({ debts, income, bills, goals, spending, savings }) => {
            const [cowClicks, setCowClicks] = useState(0);
            const totalDebt = debts.reduce((sum, d) => sum + d.balance, 0);
            const totalIncome = income.reduce((sum, i) => sum + i.amount, 0);
            const totalBills = bills.reduce((sum, b) => sum + b.amount, 0);
            const totalSavings = savings.reduce((sum, s) => sum + s.balance, 0);
            const netMonthly = totalIncome - totalBills;
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthlySpending = spending.filter(s => s.monthYear === currentMonth)
                .reduce((sum, s) => sum + s.amount, 0);

            const cowMessages = [
                "Moo! Keep going!",
                "Keep saving!",
                "You're doing great!",
                "Moo-ney matters!",
                "Stay on budget!",
                "Financial moo-tivation!"
            ];

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                        <div>
                            <h1 className="text-3xl md:text-4xl lg:text-5xl font-bold mb-2">
                                <span className="bg-gradient-to-r from-emerald-400 via-green-400 to-lime-400 bg-clip-text text-transparent">
                                    Financial Overview
                                </span>
                            </h1>
                            <p className="text-gray-400 text-sm md:text-base">Track your finances in real-time</p>
                        </div>
                        <div 
                            className="cow-emoji" 
                            onClick={() => {
                                setCowClicks(prev => prev + 1);
                                setTimeout(() => setCowClicks(0), 2000);
                            }}
                            title={cowMessages[cowClicks % cowMessages.length]}
                        >
                            üêÆ
                        </div>
                    </div>
                    
                    {cowClicks > 3 && (
                        <div className="glass rounded-2xl p-4 mb-4 text-center">
                            <p className="text-lg font-semibold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                                {cowMessages[cowClicks % cowMessages.length]}
                            </p>
                        </div>
                    )}
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                        <div className="glass rounded-2xl p-6 card-hover gradient-border">
                            <div className="flex items-center justify-between mb-3">
                                <p className="text-gray-300 text-sm font-semibold tracking-wide uppercase">Total Savings</p>
                                <svg className="w-9 h-9 text-emerald-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                                    <path fillRule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clipRule="evenodd"/>
                                </svg>
                            </div>
                            <p className="text-3xl font-bold bg-gradient-to-r from-emerald-400 to-green-400 bg-clip-text text-transparent drop-shadow-lg">
                                {formatCurrency(totalSavings)}
                            </p>
                        </div>
                        <div className="glass rounded-2xl p-6 card-hover gradient-border">
                            <div className="flex items-center justify-between mb-3">
                                <p className="text-gray-300 text-sm font-semibold tracking-wide uppercase">Total Debt</p>
                                <svg className="w-9 h-9 text-red-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                                    <path fillRule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clipRule="evenodd"/>
                                </svg>
                            </div>
                            <p className="text-3xl font-bold bg-gradient-to-r from-red-400 to-rose-400 bg-clip-text text-transparent drop-shadow-lg">
                                {formatCurrency(totalDebt)}
                            </p>
                        </div>
                        <div className="glass rounded-2xl p-6 card-hover gradient-border">
                            <div className="flex items-center justify-between mb-3">
                                <p className="text-gray-300 text-sm font-semibold tracking-wide uppercase">Monthly Income</p>
                                <svg className="w-9 h-9 text-lime-400 drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <p className="text-3xl font-bold bg-gradient-to-r from-lime-400 to-green-400 bg-clip-text text-transparent drop-shadow-lg">
                                {formatCurrency(totalIncome)}
                            </p>
                        </div>
                        <div className="glass rounded-2xl p-6 card-hover gradient-border">
                            <div className="flex items-center justify-between mb-3">
                                <p className="text-gray-300 text-sm font-semibold tracking-wide uppercase">Monthly Bills</p>
                                <svg className="w-9 h-9 text-amber-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                    <path fillRule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clipRule="evenodd"/>
                                </svg>
                            </div>
                            <p className="text-3xl font-bold bg-gradient-to-r from-amber-400 to-yellow-400 bg-clip-text text-transparent drop-shadow-lg">
                                {formatCurrency(totalBills)}
                            </p>
                        </div>
                        <div className="glass rounded-2xl p-6 card-hover gradient-border">
                            <div className="flex items-center justify-between mb-3">
                                <p className="text-gray-300 text-sm font-semibold tracking-wide uppercase">Net Monthly</p>
                                {netMonthly >= 0 ? (
                                    <svg className="w-9 h-9 text-emerald-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"/>
                                    </svg>
                                ) : (
                                    <svg className="w-9 h-9 text-red-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                        <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd"/>
                                    </svg>
                                )}
                            </div>
                            <p className={`text-3xl font-bold bg-gradient-to-r ${netMonthly >= 0 ? 'from-emerald-400 to-green-400' : 'from-red-400 to-rose-400'} bg-clip-text text-transparent drop-shadow-lg`}>
                                {formatCurrency(netMonthly)}
                            </p>
                        </div>
                    </div>

                    <div className="glass rounded-2xl p-8 card-hover">
                        <div className="flex items-center gap-3 mb-6">
                            <svg className="w-10 h-10 text-emerald-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
                            </svg>
                            <h3 className="text-2xl font-bold text-gray-100">This Month's Spending</h3>
                        </div>
                        <p className="text-5xl font-bold bg-gradient-to-r from-emerald-400 via-green-400 to-lime-400 bg-clip-text text-transparent drop-shadow-lg">
                            {formatCurrency(monthlySpending)}
                        </p>
                        <div className="mt-4 h-2 bg-gray-700 rounded-full overflow-hidden">
                            <div 
                                className="h-full bg-gradient-to-r from-emerald-500 via-green-500 to-lime-500 progress-bar shimmer"
                                style={{ width: `${Math.min((monthlySpending / (totalIncome || 1)) * 100, 100)}%` }}
                            ></div>
                        </div>
                        <p className="text-sm text-gray-400 mt-2">
                            {((monthlySpending / (totalIncome || 1)) * 100).toFixed(1)}% of monthly income
                        </p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="glass rounded-2xl p-6 card-hover">
                            <div className="flex items-center gap-3 mb-6">
                                <svg className="w-7 h-7 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                <h3 className="text-xl font-bold">Debt Overview</h3>
                            </div>
                            <div className="space-y-3">
                                {debts.length > 0 ? debts.map(debt => (
                                    <div key={debt.id} className="flex justify-between items-center p-4 bg-gray-800/50 rounded-xl">
                                        <span className="font-medium">{debt.name}</span>
                                        <span className="font-bold text-red-400">{formatCurrency(debt.balance)}</span>
                                    </div>
                                )) : (
                                    <p className="text-gray-400 text-center py-8">No debts tracked yet. Great job! üéâ</p>
                                )}
                            </div>
                        </div>

                        <div className="glass rounded-2xl p-6 card-hover">
                            <div className="flex items-center gap-3 mb-6">
                                <svg className="w-7 h-7 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clipRule="evenodd"/>
                                </svg>
                                <h3 className="text-xl font-bold">Goals Progress</h3>
                            </div>
                            <div className="space-y-4">
                                {goals.length > 0 ? goals.map(goal => {
                                    const progress = (goal.current / goal.target) * 100;
                                    return (
                                        <div key={goal.id}>
                                            <div className="flex justify-between mb-2">
                                                <span className="font-medium">{goal.name}</span>
                                                <span className="text-sm text-gray-400">
                                                    {progress.toFixed(0)}%
                                                </span>
                                            </div>
                                            <div className="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                                                <div
                                                    className="h-full bg-gradient-to-r from-emerald-500 to-green-500 progress-bar"
                                                    style={{ width: `${Math.min(progress, 100)}%` }}
                                                ></div>
                                            </div>
                                            <p className="text-xs text-gray-400 mt-1">
                                                {formatCurrency(goal.current)} / {formatCurrency(goal.target)}
                                            </p>
                                        </div>
                                    );
                                }) : (
                                    <p className="text-gray-400 text-center py-8">No goals set yet. Start planning! üöÄ</p>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ============ DEBT MANAGEMENT COMPONENT ============
        const DebtManager = ({ debts, setDebts, extraPayments, setExtraPayments }) => {
            const [showAddForm, setShowAddForm] = useState(false);
            const [newDebt, setNewDebt] = useState({
                name: '', balance: '', interestRate: '', monthlyPayment: '', type: 'credit-card',
                paymentStartDate: '', interestStartDate: ''
            });
            const [showExtraPayment, setShowExtraPayment] = useState(null);
            const [extraAmount, setExtraAmount] = useState('');
            const [extraMonth, setExtraMonth] = useState('');

            const addDebt = async () => {
                if (!newDebt.name || !newDebt.balance || !newDebt.interestRate || !newDebt.monthlyPayment) return;
                
                const debtData = {
                    name: newDebt.name,
                    balance: parseFloat(newDebt.balance),
                    interestRate: parseFloat(newDebt.interestRate),
                    monthlyPayment: parseFloat(newDebt.monthlyPayment),
                    type: newDebt.type,
                    paymentStartDate: newDebt.paymentStartDate || null,
                    interestStartDate: newDebt.interestStartDate || null,
                    createdAt: new Date().toISOString()
                };

                const docRef = await db.collection('debts').add(debtData);
                setDebts([...debts, { id: docRef.id, ...debtData }]);
                setNewDebt({ name: '', balance: '', interestRate: '', monthlyPayment: '', type: 'credit-card', paymentStartDate: '', interestStartDate: '' });
                setShowAddForm(false);
            };

            const deleteDebt = async (id) => {
                await db.collection('debts').doc(id).delete();
                setDebts(debts.filter(d => d.id !== id));
            };

            const addExtraPayment = async (debtId) => {
                if (!extraAmount || !extraMonth) return;
                
                const paymentData = {
                    debtId,
                    amount: parseFloat(extraAmount),
                    monthYear: extraMonth,
                    createdAt: new Date().toISOString()
                };

                const docRef = await db.collection('extraPayments').add(paymentData);
                setExtraPayments([...extraPayments, { id: docRef.id, ...paymentData }]);
                setExtraAmount('');
                setExtraMonth('');
                setShowExtraPayment(null);
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            <svg className="w-12 h-12 text-rose-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                                <path fillRule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clipRule="evenodd"/>
                            </svg>
                            <span className="bg-gradient-to-r from-rose-400 via-red-400 to-pink-400 bg-clip-text text-transparent drop-shadow-lg">
                                Debt Management
                            </span>
                        </h1>
                        <button
                            onClick={() => setShowAddForm(!showAddForm)}
                            className="px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg"
                        >
                            {showAddForm ? 'Cancel' : '+ Add Debt'}
                        </button>
                    </div>

                    {showAddForm && (
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <h3 className="text-xl font-semibold mb-4">Add New Debt</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input
                                    type="text"
                                    placeholder="Debt Name"
                                    value={newDebt.name}
                                    onChange={(e) => setNewDebt({...newDebt, name: e.target.value})}
                                    className="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500"
                                />
                                <select
                                    value={newDebt.type}
                                    onChange={(e) => setNewDebt({...newDebt, type: e.target.value})}
                                    className="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="credit-card">Credit Card</option>
                                    <option value="student-loan">Student Loan</option>
                                </select>
                                <input
                                    type="number"
                                    placeholder="Current Balance"
                                    value={newDebt.balance}
                                    onChange={(e) => setNewDebt({...newDebt, balance: e.target.value})}
                                    className="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500"
                                />
                                <input
                                    type="number"
                                    step="0.01"
                                    placeholder="Interest Rate (%)"
                                    value={newDebt.interestRate}
                                    onChange={(e) => setNewDebt({...newDebt, interestRate: e.target.value})}
                                    className="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500"
                                />
                                <input
                                    type="number"
                                    placeholder="Monthly Payment"
                                    value={newDebt.monthlyPayment}
                                    onChange={(e) => setNewDebt({...newDebt, monthlyPayment: e.target.value})}
                                    className="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500"
                                />
                                {newDebt.type === 'student-loan' && (
                                    <div className="md:col-span-2">
                                        <label className="block text-sm text-gray-400 mb-2">Payment Start Date (optional)</label>
                                        <input
                                            type="date"
                                            value={newDebt.paymentStartDate}
                                            onChange={(e) => setNewDebt({...newDebt, paymentStartDate: e.target.value})}
                                            className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">If payments haven't started yet, select when they will begin</p>
                                    </div>
                                )}
                                {newDebt.type === 'credit-card' && (
                                    <div className="md:col-span-2">
                                        <label className="block text-sm text-gray-400 mb-2">Interest Start Date (optional)</label>
                                        <input
                                            type="date"
                                            value={newDebt.interestStartDate}
                                            onChange={(e) => setNewDebt({...newDebt, interestStartDate: e.target.value})}
                                            className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">For promotional 0% APR offers, select when regular interest begins</p>
                                    </div>
                                )}
                            </div>
                            <button
                                onClick={addDebt}
                                className="mt-4 px-6 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition"
                            >
                                Add Debt
                            </button>
                        </div>
                    )}

                    <div className="space-y-4">
                        {debts.map(debt => {
                            const debtExtras = extraPayments
                                .filter(ep => ep.debtId === debt.id)
                                .reduce((acc, ep) => ({ ...acc, [ep.monthYear]: ep.amount }), {});
                            
                            const monthsToPayoff = calculateDebtPayoff(
                                debt.balance,
                                debt.interestRate,
                                debt.monthlyPayment,
                                debtExtras,
                                debt.paymentStartDate,
                                debt.interestStartDate
                            );
                            
                            const payoffDate = new Date();
                            payoffDate.setMonth(payoffDate.getMonth() + monthsToPayoff);

                            return (
                                <div key={debt.id} className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 className="text-xl font-semibold">{debt.name}</h3>
                                            <span className="text-sm text-gray-400 capitalize">
                                                {debt.type.replace('-', ' ')}
                                            </span>
                                        </div>
                                        <button
                                            onClick={() => deleteDebt(debt.id)}
                                            className="text-red-400 hover:text-red-300"
                                        >
                                            Delete
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                        <div>
                                            <p className="text-sm text-gray-400">Balance</p>
                                            <p className="text-lg font-semibold">{formatCurrency(debt.balance)}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-400">Interest Rate</p>
                                            <p className="text-lg font-semibold">{debt.interestRate}%</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-400">Monthly Payment</p>
                                            <p className="text-lg font-semibold">{formatCurrency(debt.monthlyPayment)}</p>
                                        </div>
                                        <div>
                                            <p className="text-sm text-gray-400">Payoff Date</p>
                                            <p className="text-lg font-semibold text-green-400">
                                                {payoffDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
                                            </p>
                                        </div>
                                    </div>
                                    
                                    {(debt.paymentStartDate || debt.interestStartDate) && (
                                        <div className="mb-4 p-3 bg-gray-700/50 rounded-lg border border-gray-600">
                                            {debt.type === 'student-loan' && debt.paymentStartDate && (
                                                <div className="flex items-center gap-2 text-sm">
                                                    <svg className="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clipRule="evenodd"/>
                                                    </svg>
                                                    <span className="text-gray-300">
                                                        <span className="text-blue-400 font-semibold">Payments start:</span> {new Date(debt.paymentStartDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                                                        {new Date(debt.paymentStartDate) > new Date() && (
                                                            <span className="ml-2 text-yellow-400">(Grace Period)</span>
                                                        )}
                                                    </span>
                                                </div>
                                            )}
                                            {debt.type === 'credit-card' && debt.interestStartDate && (
                                                <div className="flex items-center gap-2 text-sm">
                                                    <svg className="w-4 h-4 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clipRule="evenodd"/>
                                                    </svg>
                                                    <span className="text-gray-300">
                                                        <span className="text-purple-400 font-semibold">Interest starts:</span> {new Date(debt.interestStartDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                                                        {new Date(debt.interestStartDate) > new Date() && (
                                                            <span className="ml-2 text-green-400">(0% APR Active)</span>
                                                        )}
                                                    </span>
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    <div className="mb-4">
                                        <p className="text-sm text-gray-400 mb-2">
                                            Months to payoff: {monthsToPayoff}
                                        </p>
                                        <div className="w-full bg-gray-700 rounded-full h-3">
                                            <div
                                                className="bg-green-500 h-3 rounded-full transition-all"
                                                style={{ width: `${Math.max(0, 100 - (debt.balance / (debt.balance + 1000)) * 100)}%` }}
                                            ></div>
                                        </div>
                                    </div>

                                    <div>
                                        {showExtraPayment === debt.id ? (
                                            <div className="flex gap-2 mt-2">
                                                <input
                                                    type="number"
                                                    placeholder="Amount"
                                                    value={extraAmount}
                                                    onChange={(e) => setExtraAmount(e.target.value)}
                                                    className="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm"
                                                />
                                                <input
                                                    type="month"
                                                    value={extraMonth}
                                                    onChange={(e) => setExtraMonth(e.target.value)}
                                                    className="px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm"
                                                />
                                                <button
                                                    onClick={() => addExtraPayment(debt.id)}
                                                    className="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm"
                                                >
                                                    Add
                                                </button>
                                                <button
                                                    onClick={() => setShowExtraPayment(null)}
                                                    className="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-sm"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        ) : (
                                            <button
                                                onClick={() => setShowExtraPayment(debt.id)}
                                                className="text-blue-400 hover:text-blue-300 text-sm"
                                            >
                                                + Add Extra Payment
                                            </button>
                                        )}
                                        
                                        {Object.keys(debtExtras).length > 0 && (
                                            <div className="mt-3 text-sm">
                                                <p className="text-gray-400 mb-1">Extra Payments:</p>
                                                <div className="space-y-1">
                                                    {Object.entries(debtExtras).map(([month, amount]) => (
                                                        <div key={month} className="flex justify-between text-gray-300">
                                                            <span>{month}</span>
                                                            <span>{formatCurrency(amount)}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // ============ INCOME & BILLS COMPONENT ============
        const IncomeBills = ({ income, setIncome, bills, setBills }) => {
            const [showIncomeForm, setShowIncomeForm] = useState(false);
            const [showBillForm, setShowBillForm] = useState(false);
            const [newIncome, setNewIncome] = useState({ name: '', amount: '' });
            const [newBill, setNewBill] = useState({ name: '', amount: '', dueDate: '' });
            const [editingIncomeId, setEditingIncomeId] = useState(null);
            const [editingBillId, setEditingBillId] = useState(null);

            const addIncome = async () => {
                if (!newIncome.name || !newIncome.amount) return;
                const incomeData = {
                    name: newIncome.name,
                    amount: parseFloat(newIncome.amount),
                    createdAt: new Date().toISOString()
                };
                const docRef = await db.collection('income').add(incomeData);
                setIncome([...income, { id: docRef.id, ...incomeData }]);
                setNewIncome({ name: '', amount: '' });
                setShowIncomeForm(false);
            };

            const updateIncome = async (id, updatedData) => {
                const incomeData = {
                    name: updatedData.name,
                    amount: parseFloat(updatedData.amount)
                };
                await db.collection('income').doc(id).update(incomeData);
                setIncome(income.map(i => i.id === id ? { ...i, ...incomeData } : i));
                setEditingIncomeId(null);
            };

            const deleteIncome = async (id) => {
                if (!confirm('Delete this income source?')) return;
                await db.collection('income').doc(id).delete();
                setIncome(income.filter(i => i.id !== id));
            };

            const addBill = async () => {
                if (!newBill.name || !newBill.amount || !newBill.dueDate) return;
                const billData = {
                    name: newBill.name,
                    amount: parseFloat(newBill.amount),
                    dueDate: parseInt(newBill.dueDate),
                    createdAt: new Date().toISOString()
                };
                const docRef = await db.collection('bills').add(billData);
                setBills([...bills, { id: docRef.id, ...billData }]);
                setNewBill({ name: '', amount: '', dueDate: '' });
                setShowBillForm(false);
            };

            const updateBill = async (id, updatedData) => {
                const billData = {
                    name: updatedData.name,
                    amount: parseFloat(updatedData.amount),
                    dueDate: parseInt(updatedData.dueDate)
                };
                await db.collection('bills').doc(id).update(billData);
                setBills(bills.map(b => b.id === id ? { ...b, ...billData } : b));
                setEditingBillId(null);
            };

            const deleteBill = async (id) => {
                if (!confirm('Delete this bill?')) return;
                await db.collection('bills').doc(id).delete();
                setBills(bills.filter(b => b.id !== id));
            };

            const totalIncome = income.reduce((sum, i) => sum + i.amount, 0);
            const totalBills = bills.reduce((sum, b) => sum + b.amount, 0);
            const netIncome = totalIncome - totalBills;

            return (
                <div className="space-y-6">
                    <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                        <svg className="w-12 h-12 text-lime-400 drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span className="bg-gradient-to-r from-lime-400 via-green-400 to-emerald-400 bg-clip-text text-transparent drop-shadow-lg">
                            Income & Bills
                        </span>
                    </h1>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <p className="text-gray-400 text-sm mb-2">Total Income</p>
                            <p className="text-2xl font-bold text-green-400">{formatCurrency(totalIncome)}</p>
                        </div>
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <p className="text-gray-400 text-sm mb-2">Total Bills</p>
                            <p className="text-2xl font-bold text-red-400">{formatCurrency(totalBills)}</p>
                        </div>
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <p className="text-gray-400 text-sm mb-2">Net Income</p>
                            <p className={`text-2xl font-bold ${netIncome >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                {formatCurrency(netIncome)}
                            </p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Income Section */}
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-semibold">Income Sources</h2>
                                <button
                                    onClick={() => setShowIncomeForm(!showIncomeForm)}
                                    className="px-3 py-1 bg-green-600 hover:bg-green-700 rounded text-sm transition"
                                >
                                    {showIncomeForm ? 'Cancel' : 'Add'}
                                </button>
                            </div>

                            {showIncomeForm && (
                                <div className="mb-4 space-y-2">
                                    <input
                                        type="text"
                                        placeholder="Income Name"
                                        value={newIncome.name}
                                        onChange={(e) => setNewIncome({...newIncome, name: e.target.value})}
                                        className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Amount"
                                        value={newIncome.amount}
                                        onChange={(e) => setNewIncome({...newIncome, amount: e.target.value})}
                                        className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm"
                                    />
                                    <button
                                        onClick={addIncome}
                                        className="w-full px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm"
                                    >
                                        Add Income
                                    </button>
                                </div>
                            )}

                            <div className="space-y-2">
                                {income.map(inc => (
                                    <div key={inc.id} className="p-3 bg-gray-700 rounded-lg">
                                        {editingIncomeId === inc.id ? (
                                            <div className="space-y-2">
                                                <input
                                                    type="text"
                                                    defaultValue={inc.name}
                                                    id={`income-name-${inc.id}`}
                                                    className="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-lg text-sm"
                                                />
                                                <input
                                                    type="number"
                                                    defaultValue={inc.amount}
                                                    id={`income-amount-${inc.id}`}
                                                    className="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-lg text-sm"
                                                />
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            const name = document.getElementById(`income-name-${inc.id}`).value;
                                                            const amount = document.getElementById(`income-amount-${inc.id}`).value;
                                                            updateIncome(inc.id, { name, amount });
                                                        }}
                                                        className="flex-1 px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm"
                                                    >
                                                        Save
                                                    </button>
                                                    <button
                                                        onClick={() => setEditingIncomeId(null)}
                                                        className="flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-sm"
                                                    >
                                                        Cancel
                                                    </button>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="flex justify-between items-center">
                                                <span>{inc.name}</span>
                                                <div className="flex items-center gap-3">
                                                    <span className="font-semibold">{formatCurrency(inc.amount)}</span>
                                                    <button
                                                        onClick={() => setEditingIncomeId(inc.id)}
                                                        className="text-blue-400 hover:text-blue-300 text-sm"
                                                    >
                                                        Edit
                                                    </button>
                                                    <button
                                                        onClick={() => deleteIncome(inc.id)}
                                                        className="text-red-400 hover:text-red-300 text-sm"
                                                    >
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Bills Section */}
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-xl font-semibold">Monthly Bills</h2>
                                <button
                                    onClick={() => setShowBillForm(!showBillForm)}
                                    className="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 rounded text-sm transition"
                                >
                                    {showBillForm ? 'Cancel' : 'Add'}
                                </button>
                            </div>

                            {showBillForm && (
                                <div className="mb-4 space-y-2">
                                    <input
                                        type="text"
                                        placeholder="Bill Name"
                                        value={newBill.name}
                                        onChange={(e) => setNewBill({...newBill, name: e.target.value})}
                                        className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Amount"
                                        value={newBill.amount}
                                        onChange={(e) => setNewBill({...newBill, amount: e.target.value})}
                                        className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm"
                                    />
                                    <input
                                        type="number"
                                        placeholder="Due Date (Day of Month)"
                                        min="1"
                                        max="31"
                                        value={newBill.dueDate}
                                        onChange={(e) => setNewBill({...newBill, dueDate: e.target.value})}
                                        className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm"
                                    />
                                    <button
                                        onClick={addBill}
                                        className="w-full px-3 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-sm"
                                    >
                                        Add Bill
                                    </button>
                                </div>
                            )}

                            <div className="space-y-2">
                                {bills.sort((a, b) => a.dueDate - b.dueDate).map(bill => (
                                    <div key={bill.id} className="p-3 bg-gray-700 rounded-lg">
                                        {editingBillId === bill.id ? (
                                            <div className="space-y-2">
                                                <input
                                                    type="text"
                                                    defaultValue={bill.name}
                                                    id={`bill-name-${bill.id}`}
                                                    className="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-lg text-sm"
                                                />
                                                <input
                                                    type="number"
                                                    defaultValue={bill.amount}
                                                    id={`bill-amount-${bill.id}`}
                                                    className="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-lg text-sm"
                                                />
                                                <input
                                                    type="number"
                                                    placeholder="Due Date (Day of Month)"
                                                    min="1"
                                                    max="31"
                                                    defaultValue={bill.dueDate}
                                                    id={`bill-duedate-${bill.id}`}
                                                    className="w-full px-3 py-2 bg-gray-600 border border-gray-500 rounded-lg text-sm"
                                                />
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            const name = document.getElementById(`bill-name-${bill.id}`).value;
                                                            const amount = document.getElementById(`bill-amount-${bill.id}`).value;
                                                            const dueDate = document.getElementById(`bill-duedate-${bill.id}`).value;
                                                            updateBill(bill.id, { name, amount, dueDate });
                                                        }}
                                                        className="flex-1 px-3 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-sm"
                                                    >
                                                        Save
                                                    </button>
                                                    <button
                                                        onClick={() => setEditingBillId(null)}
                                                        className="flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-sm"
                                                    >
                                                        Cancel
                                                    </button>
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="flex justify-between items-center">
                                                <div>
                                                    <p>{bill.name}</p>
                                                    <p className="text-xs text-gray-400">Due: Day {bill.dueDate}</p>
                                                </div>
                                                <div className="flex items-center gap-3">
                                                    <span className="font-semibold">{formatCurrency(bill.amount)}</span>
                                                    <button
                                                        onClick={() => setEditingBillId(bill.id)}
                                                        className="text-blue-400 hover:text-blue-300 text-sm"
                                                    >
                                                        Edit
                                                    </button>
                                                    <button
                                                        onClick={() => deleteBill(bill.id)}
                                                        className="text-red-400 hover:text-red-300 text-sm"
                                                    >
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ============ GOALS COMPONENT ============
        const Goals = ({ goals, setGoals }) => {
            const [showForm, setShowForm] = useState(false);
            const [newGoal, setNewGoal] = useState({ name: '', target: '', current: '', isWedding: false });
            const [confetti, setConfetti] = useState(false);

            const addGoal = async () => {
                if (!newGoal.name || !newGoal.target) return;
                const goalData = {
                    name: newGoal.name,
                    target: parseFloat(newGoal.target),
                    current: parseFloat(newGoal.current) || 0,
                    isWedding: newGoal.isWedding,
                    createdAt: new Date().toISOString()
                };
                const docRef = await db.collection('goals').add(goalData);
                setGoals([...goals, { id: docRef.id, ...goalData }]);
                setNewGoal({ name: '', target: '', current: '', isWedding: false });
                setShowForm(false);
            };

            const updateGoalProgress = async (id, newCurrent) => {
                await db.collection('goals').doc(id).update({ current: parseFloat(newCurrent) });
                setGoals(goals.map(g => g.id === id ? {...g, current: parseFloat(newCurrent)} : g));
            };

            const deleteGoal = async (id) => {
                await db.collection('goals').doc(id).delete();
                setGoals(goals.filter(g => g.id !== id));
            };

            const weddingGoal = goals.find(g => g.isWedding);
            const otherGoals = goals.filter(g => !g.isWedding);

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            <svg className="w-12 h-12 text-cyan-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clipRule="evenodd"/>
                            </svg>
                            <span className="bg-gradient-to-r from-cyan-400 via-blue-400 to-indigo-400 bg-clip-text text-transparent drop-shadow-lg">
                                Goals
                            </span>
                        </h1>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg"
                        >
                            {showForm ? 'Cancel' : '+ Add Goal'}
                        </button>
                    </div>

                    {showForm && (
                        <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <h3 className="text-xl font-semibold mb-4">Add New Goal</h3>
                            <div className="space-y-3">
                                <input
                                    type="text"
                                    placeholder="Goal Name"
                                    value={newGoal.name}
                                    onChange={(e) => setNewGoal({...newGoal, name: e.target.value})}
                                    className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg"
                                />
                                <input
                                    type="number"
                                    placeholder="Target Amount"
                                    value={newGoal.target}
                                    onChange={(e) => setNewGoal({...newGoal, target: e.target.value})}
                                    className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg"
                                />
                                <input
                                    type="number"
                                    placeholder="Current Amount"
                                    value={newGoal.current}
                                    onChange={(e) => setNewGoal({...newGoal, current: e.target.value})}
                                    className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg"
                                />
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={newGoal.isWedding}
                                        onChange={(e) => setNewGoal({...newGoal, isWedding: e.target.checked})}
                                        className="w-4 h-4"
                                    />
                                    <span>Wedding Goal</span>
                                </label>
                                <button
                                    onClick={addGoal}
                                    className="w-full px-6 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition"
                                >
                                    Add Goal
                                </button>
                            </div>
                        </div>
                    )}

                    {weddingGoal && (
                        <div className="bg-gradient-to-br from-pink-900 to-purple-900 p-8 rounded-lg border border-pink-700">
                            <div className="flex justify-between items-start mb-6">
                                <div>
                                    <h2 className="text-3xl font-bold mb-2">üíç {weddingGoal.name}</h2>
                                    <p className="text-gray-300">Your special day is getting closer!</p>
                                </div>
                                <button
                                    onClick={() => deleteGoal(weddingGoal.id)}
                                    className="text-red-300 hover:text-red-200 text-sm"
                                >
                                    Delete
                                </button>
                            </div>
                            
                            <div className="grid grid-cols-3 gap-4 mb-6">
                                <div className="bg-black bg-opacity-30 p-4 rounded-lg">
                                    <p className="text-sm text-gray-300 mb-1">Target</p>
                                    <p className="text-2xl font-bold">{formatCurrency(weddingGoal.target)}</p>
                                </div>
                                <div className="bg-black bg-opacity-30 p-4 rounded-lg">
                                    <p className="text-sm text-gray-300 mb-1">Saved</p>
                                    <p className="text-2xl font-bold text-green-400">{formatCurrency(weddingGoal.current)}</p>
                                </div>
                                <div className="bg-black bg-opacity-30 p-4 rounded-lg">
                                    <p className="text-sm text-gray-300 mb-1">Remaining</p>
                                    <p className="text-2xl font-bold text-yellow-400">
                                        {formatCurrency(weddingGoal.target - weddingGoal.current)}
                                    </p>
                                </div>
                            </div>

                            <div className="mb-4">
                                <div className="flex justify-between mb-2">
                                    <span className="text-sm">Progress</span>
                                    <span className="text-sm font-semibold">
                                        {((weddingGoal.current / weddingGoal.target) * 100).toFixed(1)}%
                                    </span>
                                </div>
                                <div className="w-full bg-gray-800 rounded-full h-4">
                                    <div
                                        className="bg-gradient-to-r from-pink-500 to-purple-500 h-4 rounded-full transition-all"
                                        style={{ width: `${Math.min((weddingGoal.current / weddingGoal.target) * 100, 100)}%` }}
                                    ></div>
                                </div>
                            </div>

                            <div>
                                <label className="block text-sm mb-2">Update Saved Amount</label>
                                <div className="flex gap-2">
                                    <input
                                        type="number"
                                        defaultValue={weddingGoal.current}
                                        onBlur={(e) => updateGoalProgress(weddingGoal.id, e.target.value)}
                                        className="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg"
                                    />
                                </div>
                            </div>
                        </div>
                    )}

                    <div>
                        <h2 className="text-2xl font-semibold mb-4">Other Goals</h2>
                        <div className="space-y-4">
                            {otherGoals.map(goal => {
                                const progress = (goal.current / goal.target) * 100;
                                return (
                                    <div key={goal.id} className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                                        <div className="flex justify-between items-start mb-4">
                                            <h3 className="text-xl font-semibold">{goal.name}</h3>
                                            <button
                                                onClick={() => deleteGoal(goal.id)}
                                                className="text-red-400 hover:text-red-300 text-sm"
                                            >
                                                Delete
                                            </button>
                                        </div>

                                        <div className="grid grid-cols-3 gap-4 mb-4">
                                            <div>
                                                <p className="text-sm text-gray-400">Target</p>
                                                <p className="text-lg font-semibold">{formatCurrency(goal.target)}</p>
                                            </div>
                                            <div>
                                                <p className="text-sm text-gray-400">Current</p>
                                                <p className="text-lg font-semibold text-green-400">{formatCurrency(goal.current)}</p>
                                            </div>
                                            <div>
                                                <p className="text-sm text-gray-400">Remaining</p>
                                                <p className="text-lg font-semibold text-yellow-400">
                                                    {formatCurrency(goal.target - goal.current)}
                                                </p>
                                            </div>
                                        </div>

                                        <div className="mb-4">
                                            <div className="flex justify-between mb-2">
                                                <span className="text-sm text-gray-400">Progress</span>
                                                <span className="text-sm font-semibold">{progress.toFixed(1)}%</span>
                                            </div>
                                            <div className="w-full bg-gray-700 rounded-full h-3">
                                                <div
                                                    className="bg-gradient-to-r from-emerald-500 to-green-500 h-3 rounded-full transition-all"
                                                    style={{ width: `${Math.min(progress, 100)}%` }}
                                                ></div>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm text-gray-400 mb-2">Update Amount</label>
                                            <input
                                                type="number"
                                                defaultValue={goal.current}
                                                onBlur={(e) => updateGoalProgress(goal.id, e.target.value)}
                                                className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg"
                                            />
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ SAVINGS ACCOUNTS COMPONENT ============
        const SavingsAccounts = ({ savings, setSavings }) => {
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({ name: '', balance: '', interestRate: '', type: '' });

            const savingsTypes = [
                { value: 'high-yield', label: 'High-Yield Savings' },
                { value: 'emergency', label: 'Emergency Fund' },
                { value: 'investment', label: 'Investment Account' },
                { value: 'retirement', label: 'Retirement (401k/IRA)' },
                { value: 'general', label: 'General Savings' }
            ];

            const addOrUpdateSavings = async () => {
                if (!formData.name || !formData.balance || !formData.type) return;
                
                const savingsData = {
                    name: formData.name,
                    balance: parseFloat(formData.balance),
                    interestRate: parseFloat(formData.interestRate) || 0,
                    type: formData.type,
                    lastUpdated: new Date().toISOString()
                };

                try {
                    if (editingId) {
                        await db.collection('savings').doc(editingId).update(savingsData);
                        setSavings(savings.map(s => s.id === editingId ? { ...s, ...savingsData } : s));
                        setEditingId(null);
                    } else {
                        const docRef = await db.collection('savings').add(savingsData);
                        setSavings([...savings, { id: docRef.id, ...savingsData }]);
                    }
                    setFormData({ name: '', balance: '', interestRate: '', type: '' });
                    setShowForm(false);
                } catch (error) {
                    console.error('Error saving account:', error);
                    alert('Failed to save account. Please try again.');
                }
            };

            const deleteSavings = async (id) => {
                if (!confirm('Are you sure you want to delete this savings account?')) return;
                await db.collection('savings').doc(id).delete();
                setSavings(savings.filter(s => s.id !== id));
            };

            const startEdit = (account) => {
                setFormData({
                    name: account.name,
                    balance: account.balance.toString(),
                    interestRate: account.interestRate?.toString() || '',
                    type: account.type
                });
                setEditingId(account.id);
                setShowForm(true);
            };

            const cancelEdit = () => {
                setFormData({ name: '', balance: '', interestRate: '', type: '' });
                setEditingId(null);
                setShowForm(false);
            };

            const totalSavings = savings.reduce((sum, s) => sum + s.balance, 0);
            const groupedSavings = savings.reduce((acc, account) => {
                if (!acc[account.type]) acc[account.type] = [];
                acc[account.type].push(account);
                return acc;
            }, {});

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            <svg className="w-12 h-12 text-teal-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/>
                                <path fillRule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clipRule="evenodd"/>
                            </svg>
                            <span className="bg-gradient-to-r from-teal-400 via-cyan-400 to-sky-400 bg-clip-text text-transparent drop-shadow-lg">
                                Savings Accounts
                            </span>
                        </h1>
                        <button
                            onClick={() => showForm ? cancelEdit() : setShowForm(true)}
                            className="px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg"
                        >
                            {showForm ? 'Cancel' : '+ Add Account'}
                        </button>
                    </div>

                    <div className="glass rounded-2xl p-8 card-hover">
                        <div className="text-center">
                            <p className="text-gray-400 text-lg mb-2">Total Savings</p>
                            <p className="text-6xl font-bold bg-gradient-to-r from-emerald-400 to-green-400 bg-clip-text text-transparent">
                                {formatCurrency(totalSavings)}
                            </p>
                        </div>
                    </div>

                    {showForm && (
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">
                                {editingId ? 'Edit Savings Account' : 'Add New Savings Account'}
                            </h3>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Account Type</label>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        {savingsTypes.map(type => (
                                            <button
                                                key={type.value}
                                                onClick={() => setFormData({...formData, type: type.value})}
                                                className={`p-4 rounded-xl border-2 transition-all ${
                                                    formData.type === type.value
                                                        ? 'border-emerald-500 bg-emerald-500/10'
                                                        : 'border-gray-700 hover:border-gray-600'
                                                }`}
                                            >
                                                <div className="text-3xl mb-2">{type.icon}</div>
                                                <div className="text-sm font-medium">{type.label}</div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-2">Account Name</label>
                                    <input
                                        type="text"
                                        placeholder="e.g., Chase Savings, Ally Bank"
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        className="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                    />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Current Balance</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            placeholder="0.00"
                                            value={formData.balance}
                                            onChange={(e) => setFormData({...formData, balance: e.target.value})}
                                            className="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Interest Rate (% APY)</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            placeholder="0.00"
                                            value={formData.interestRate}
                                            onChange={(e) => setFormData({...formData, interestRate: e.target.value})}
                                            className="w-full px-4 py-3 bg-gray-800/50 border border-gray-700 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-transparent"
                                        />
                                    </div>
                                </div>
                                <button
                                    onClick={addOrUpdateSavings}
                                    className="w-full px-6 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 rounded-xl font-semibold shadow-lg"
                                >
                                    {editingId ? 'Update Account' : 'Add Account'}
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="space-y-6">
                        {savingsTypes.map(type => {
                            const accounts = groupedSavings[type.value] || [];
                            if (accounts.length === 0) return null;
                            
                            const typeTotal = accounts.reduce((sum, acc) => sum + acc.balance, 0);
                            
                            return (
                                <div key={type.value} className="glass rounded-2xl p-6">
                                    <div className="flex items-center gap-3 mb-4">
                                        <span className="text-3xl">{type.icon}</span>
                                        <div className="flex-1">
                                            <h3 className="text-xl font-bold">{type.label}</h3>
                                            <p className="text-sm text-gray-400">
                                                {formatCurrency(typeTotal)} across {accounts.length} account{accounts.length > 1 ? 's' : ''}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="space-y-3">
                                        {accounts.map(account => (
                                            <div key={account.id} className="p-4 bg-gray-800/50 rounded-xl border border-gray-700">
                                                <div className="flex justify-between items-start mb-3">
                                                    <div>
                                                        <h4 className="font-semibold text-lg">{account.name}</h4>
                                                        {account.interestRate > 0 && (
                                                            <p className="text-sm text-emerald-400">
                                                                {account.interestRate}% APY
                                                            </p>
                                                        )}
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => startEdit(account)}
                                                            className="text-emerald-400 hover:text-emerald-300 text-sm font-medium"
                                                        >
                                                            Edit
                                                        </button>
                                                        <button
                                                            onClick={() => deleteSavings(account.id)}
                                                            className="text-red-400 hover:text-red-300 text-sm font-medium"
                                                        >
                                                            Delete
                                                        </button>
                                                    </div>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <span className="text-gray-400">Balance</span>
                                                    <span className="text-2xl font-bold bg-gradient-to-r from-emerald-400 to-green-400 bg-clip-text text-transparent">
                                                        {formatCurrency(account.balance)}
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            );
                        })}
                        
                        {savings.length === 0 && (
                            <div className="text-center py-16">
                                <p className="text-6xl mb-4">üè¶</p>
                                <p className="text-gray-400 text-lg">
                                    No savings accounts yet. Add one to get started!
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ============ VOTING COMPONENTS ============
        const VotingPage = ({ title, votes, setVotes, collectionName, currentUser }) => {
            const [showForm, setShowForm] = useState(false);
            const [newOption, setNewOption] = useState('');
            const [editingOption, setEditingOption] = useState(null);
            const [editText, setEditText] = useState('');
            const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
            
            // Use the state-tracked current date
            const today = currentDate;
            const todayVote = votes.find(v => v.date === today) || { date: today, options: [], votes: {} };
            const isFood = title.includes('Food');
            
            // Check for day change and reload votes every 3 seconds
            useEffect(() => {
                const checkDateChange = async () => {
                    const newDate = new Date().toISOString().split('T')[0];
                    if (newDate !== currentDate) {
                        console.log('üîÑ Date changed from', currentDate, 'to', newDate);
                        console.log('üì• Reloading votes from Firebase...');
                        
                        // Reload votes from Firebase
                        try {
                            const votesSnapshot = await db.collection(collectionName).get();
                            const votesData = votesSnapshot.docs.map(doc => ({ 
                                id: doc.id, 
                                ...doc.data() 
                            }));
                            setVotes(votesData);
                            console.log('‚úÖ Votes reloaded:', votesData.length, 'votes found');
                            console.log('üìÖ Previous day votes should now be visible');
                            
                            // Update the current date state to trigger re-render
                            setCurrentDate(newDate);
                        } catch (error) {
                            console.error('‚ùå Error reloading votes:', error);
                        }
                        
                        setShowForm(false);
                        setEditingOption(null);
                    }
                };
                
                // Check immediately on mount
                checkDateChange();
                
                // Check every 3 seconds
                const interval = setInterval(checkDateChange, 3000);
                
                return () => clearInterval(interval);
            }, [collectionName, setVotes, currentDate]);

            const addOption = async () => {
                if (!newOption.trim()) return;
                
                const updatedOptions = [...(todayVote.options || []), newOption.trim()];
                const voteData = {
                    date: today,
                    options: updatedOptions,
                    votes: todayVote.votes || {}
                };

                try {
                    if (todayVote.id) {
                        await db.collection(collectionName).doc(todayVote.id).update(voteData);
                        setVotes(votes.map(v => v.id === todayVote.id ? { ...v, ...voteData } : v));
                    } else {
                        const docRef = await db.collection(collectionName).add(voteData);
                        setVotes([...votes, { id: docRef.id, ...voteData }]);
                    }
                    setNewOption('');
                    setShowForm(false);
                } catch (error) {
                    console.error('Error adding option:', error);
                    alert('Failed to add option. Please try again.');
                }
            };

            const deleteOption = async (optionToDelete) => {
                if (!confirm(`Delete "${optionToDelete}" from today's options?`)) return;
                
                const updatedOptions = (todayVote.options || []).filter(opt => opt !== optionToDelete);
                
                // Also remove any votes for this option
                const updatedVotes = { ...todayVote.votes };
                Object.keys(updatedVotes).forEach(userId => {
                    if (updatedVotes[userId] === optionToDelete) {
                        delete updatedVotes[userId];
                    }
                });
                
                const voteData = {
                    date: today,
                    options: updatedOptions,
                    votes: updatedVotes
                };

                try {
                    if (todayVote.id) {
                        await db.collection(collectionName).doc(todayVote.id).update(voteData);
                        setVotes(votes.map(v => v.id === todayVote.id ? { ...v, ...voteData } : v));
                    }
                } catch (error) {
                    console.error('Error deleting option:', error);
                    alert('Failed to delete option. Please try again.');
                }
            };

            const startEditOption = (option) => {
                setEditingOption(option);
                setEditText(option);
            };

            const saveEditOption = async (oldOption) => {
                if (!editText.trim() || editText === oldOption) {
                    setEditingOption(null);
                    return;
                }
                
                const updatedOptions = (todayVote.options || []).map(opt => 
                    opt === oldOption ? editText.trim() : opt
                );
                
                // Update any votes that were for the old option to the new option
                const updatedVotes = { ...todayVote.votes };
                Object.keys(updatedVotes).forEach(userId => {
                    if (updatedVotes[userId] === oldOption) {
                        updatedVotes[userId] = editText.trim();
                    }
                });
                
                const voteData = {
                    date: today,
                    options: updatedOptions,
                    votes: updatedVotes
                };

                try {
                    if (todayVote.id) {
                        await db.collection(collectionName).doc(todayVote.id).update(voteData);
                        setVotes(votes.map(v => v.id === todayVote.id ? { ...v, ...voteData } : v));
                    }
                    setEditingOption(null);
                    setEditText('');
                } catch (error) {
                    console.error('Error editing option:', error);
                    alert('Failed to edit option. Please try again.');
                }
            };

            const castVote = async (option) => {
                if (!currentUser) {
                    alert('Please log in to vote');
                    return;
                }
                
                const updatedVotes = { ...(todayVote.votes || {}), [currentUser.uid]: option };
                const voteData = {
                    date: today,
                    options: todayVote.options || [],
                    votes: updatedVotes
                };

                try {
                    if (todayVote.id) {
                        await db.collection(collectionName).doc(todayVote.id).update({ votes: updatedVotes });
                        setVotes(votes.map(v => v.id === todayVote.id ? { ...v, votes: updatedVotes } : v));
                    } else {
                        const docRef = await db.collection(collectionName).add(voteData);
                        setVotes([...votes, { id: docRef.id, ...voteData }]);
                    }
                } catch (error) {
                    console.error('Error casting vote:', error);
                    alert('Failed to cast vote. Please try again.');
                }
            };

            const getVoteCount = (option) => {
                return Object.values(todayVote.votes || {}).filter(v => v === option).length;
            };

            const userVote = currentUser ? todayVote.votes?.[currentUser.uid] : null;

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            {isFood ? (
                                <svg className="w-10 h-10 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                            ) : (
                                <svg className="w-10 h-10 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            )}
                            <span className="bg-gradient-to-r from-emerald-400 via-green-400 to-lime-400 bg-clip-text text-transparent">
                                {title}
                            </span>
                        </h1>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg"
                        >
                            {showForm ? 'Cancel' : '+ Add Option'}
                        </button>
                    </div>

                    {showForm && (
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">Add New Option</h3>
                            <div className="flex gap-2">
                                <input
                                    type="text"
                                    placeholder={`Enter ${title.includes('Food') ? 'meal' : 'workout'} option...`}
                                    value={newOption}
                                    onChange={(e) => setNewOption(e.target.value)}
                                    className="flex-1 px-5 py-3 bg-gray-800/50 border border-gray-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    onKeyPress={(e) => e.key === 'Enter' && addOption()}
                                    autoFocus
                                />
                                <button
                                    onClick={addOption}
                                    className="px-8 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-xl font-semibold shadow-lg"
                                >
                                    Add
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="glass rounded-2xl p-6">
                        <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                            <svg className="w-7 h-7 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clipRule="evenodd"/>
                            </svg>
                            Today's Vote - {formatDate(today)}
                        </h2>
                        
                        {userVote && (
                            <div className="mb-6 p-4 bg-gradient-to-r from-emerald-900/50 to-green-900/50 border-2 border-emerald-500/50 rounded-xl">
                                <p className="text-center flex items-center justify-center gap-2">
                                    <span className="text-gray-300">Your vote:</span>
                                    <span className="ml-2 text-xl font-bold bg-gradient-to-r from-emerald-400 to-green-400 bg-clip-text text-transparent">
                                        {userVote}
                                    </span>
                                    <svg className="w-5 h-5 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"/>
                                    </svg>
                                </p>
                            </div>
                        )}

                        <div className="space-y-3">
                            {(todayVote.options || []).map((option, idx) => {
                                const voteCount = getVoteCount(option);
                                const isUserVote = userVote === option;
                                const totalVotes = Object.keys(todayVote.votes || {}).length;
                                const percentage = totalVotes > 0 ? (voteCount / totalVotes * 100).toFixed(0) : 0;
                                const isEditing = editingOption === option;
                                
                                return (
                                    <div
                                        key={idx}
                                        className={`relative p-5 rounded-xl border-2 transition-all overflow-hidden ${
                                            isEditing
                                                ? 'border-blue-500 glass'
                                                : isUserVote
                                                ? 'border-emerald-500 glass'
                                                : 'border-gray-700 bg-gray-800/30 hover:border-emerald-500'
                                        }`}
                                    >
                                        {/* Vote percentage background */}
                                        {!isEditing && (
                                            <div 
                                                className="absolute inset-0 bg-gradient-to-r from-emerald-500/10 to-green-500/10 transition-all duration-500"
                                                style={{ width: `${percentage}%` }}
                                            ></div>
                                        )}
                                        
                                        {isEditing ? (
                                            <div className="relative flex gap-2">
                                                <input
                                                    type="text"
                                                    value={editText}
                                                    onChange={(e) => setEditText(e.target.value)}
                                                    className="flex-1 px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    onKeyPress={(e) => e.key === 'Enter' && saveEditOption(option)}
                                                    autoFocus
                                                />
                                                <button
                                                    onClick={() => saveEditOption(option)}
                                                    className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold"
                                                >
                                                    ‚úì
                                                </button>
                                                <button
                                                    onClick={() => setEditingOption(null)}
                                                    className="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg font-semibold"
                                                >
                                                    ‚úï
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="relative flex justify-between items-center gap-4">
                                                <div 
                                                    className="flex items-center gap-3 flex-1 cursor-pointer"
                                                    onClick={() => castVote(option)}
                                                >
                                                    {isUserVote && (
                                                        <svg className="w-6 h-6 text-emerald-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                                                        </svg>
                                                    )}
                                                    <span className="font-semibold text-lg">{option}</span>
                                                </div>
                                                <div className="flex items-center gap-3 shrink-0">
                                                    <div className="text-right">
                                                        <div className="text-2xl font-bold bg-gradient-to-r from-emerald-400 to-green-400 bg-clip-text text-transparent">
                                                            {voteCount}
                                                        </div>
                                                        <div className="text-xs text-gray-400">
                                                            {voteCount === 1 ? 'vote' : 'votes'}
                                                        </div>
                                                    </div>
                                                    {isUserVote && (
                                                        <span className="px-3 py-1 bg-gradient-to-r from-emerald-600 to-green-600 rounded-full text-xs font-semibold">
                                                            Your Pick
                                                        </span>
                                                    )}
                                                    <div className="flex gap-1">
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                startEditOption(option);
                                                            }}
                                                            className="p-2 bg-blue-600/20 hover:bg-blue-600/40 rounded-lg transition-all"
                                                            title="Edit option"
                                                        >
                                                            <svg className="w-4 h-4 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                                            </svg>
                                                        </button>
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                deleteOption(option);
                                                            }}
                                                            className="p-2 bg-red-600/20 hover:bg-red-600/40 rounded-lg transition-all"
                                                            title="Delete option"
                                                        >
                                                            <svg className="w-4 h-4 text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                            
                            {(!todayVote.options || todayVote.options.length === 0) && (
                                <div className="text-center py-16">
                                    {isFood ? (
                                        <svg className="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                                        </svg>
                                    ) : (
                                        <svg className="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                    )}
                                    <p className="text-gray-400 text-lg">
                                        No options yet. Be the first to add one!
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="glass rounded-2xl p-6">
                        <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                            <svg className="w-7 h-7 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clipRule="evenodd"/>
                            </svg>
                            Previous Days
                        </h2>
                        <div className="space-y-3">
                            {votes
                                .filter(v => v.date && v.date !== today && v.options && v.options.length > 0)
                                .sort((a, b) => new Date(b.date) - new Date(a.date))
                                .slice(0, 7)
                                .map(vote => {
                                    const winner = vote.options?.reduce((max, opt) => {
                                        const count = Object.values(vote.votes || {}).filter(v => v === opt).length;
                                        const maxCount = Object.values(vote.votes || {}).filter(v => v === max).length;
                                        return count > maxCount ? opt : max;
                                    }, vote.options?.[0] || '');
                                    
                                    return (
                                        <div key={vote.id} className="p-4 bg-gray-800/50 rounded-xl border border-gray-700">
                                            <div className="flex justify-between items-center mb-3">
                                                <p className="font-semibold text-lg">{formatDate(vote.date)}</p>
                                                {winner && (
                                                    <span className="px-3 py-1 bg-gradient-to-r from-yellow-600 to-orange-600 rounded-full text-xs font-semibold flex items-center gap-1">
                                                        <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                                        </svg>
                                                        Winner: {winner}
                                                    </span>
                                                )}
                                            </div>
                                            <div className="space-y-2">
                                                {(vote.options || []).map((option, idx) => {
                                                    const count = Object.values(vote.votes || {}).filter(v => v === option).length;
                                                    return (
                                                        <div key={idx} className="flex justify-between items-center text-sm">
                                                            <span className={`flex items-center gap-1 ${option === winner ? 'font-semibold text-yellow-400' : ''}`}>
                                                                {option === winner && (
                                                                    <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                                                    </svg>
                                                                )}
                                                                {option}
                                                            </span>
                                                            <span className="text-gray-400">{count} {count === 1 ? 'vote' : 'votes'}</span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    );
                                })}
                            {votes.filter(v => v.date && v.date !== today && v.options && v.options.length > 0).length === 0 && (
                                <div className="text-center py-12">
                                    <svg className="w-12 h-12 mx-auto mb-3 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path fillRule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clipRule="evenodd"/>
                                    </svg>
                                    <p className="text-gray-400">No previous voting history yet</p>
                                    <p className="text-sm text-gray-500 mt-2">Past votes will appear here after midnight</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ TRANSACTIONS & BUDGET COMPONENT ============
        const TransactionsBudget = ({ transactions, setTransactions, budgets, setBudgets }) => {
            const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));
            const [showTransactionForm, setShowTransactionForm] = useState(false);
            const [showBudgetForm, setShowBudgetForm] = useState(false);
            const [newTransaction, setNewTransaction] = useState({ description: '', amount: '', category: '', date: '' });
            const [editingId, setEditingId] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterCategory, setFilterCategory] = useState('all');

            const categories = [
                'Groceries', 'Dining Out', 'Entertainment', 'Transportation', 'Gas', 
                'Utilities', 'Shopping', 'Health', 'Education', 'Other'
            ];

            const getCategoryIcon = (cat) => {
                const icons = {
                    'Groceries': 'üõí', 'Dining Out': 'üçΩÔ∏è', 'Entertainment': 'üé¨',
                    'Transportation': 'üöó', 'Gas': '‚õΩ', 'Utilities': 'üí°',
                    'Shopping': 'üõçÔ∏è', 'Health': 'üè•', 'Education': 'üìö', 'Other': 'üì¶'
                };
                return icons[cat] || 'üì¶';
            };

            const addOrUpdateTransaction = async () => {
                if (!newTransaction.description || !newTransaction.amount || !newTransaction.category || !newTransaction.date) return;
                
                const transactionData = {
                    description: newTransaction.description,
                    amount: parseFloat(newTransaction.amount),
                    category: newTransaction.category,
                    date: newTransaction.date,
                    monthYear: newTransaction.date.slice(0, 7),
                    createdAt: new Date().toISOString()
                };

                if (editingId) {
                    await db.collection('transactions').doc(editingId).update(transactionData);
                    setTransactions(transactions.map(t => t.id === editingId ? { ...t, ...transactionData } : t));
                    setEditingId(null);
                } else {
                    const docRef = await db.collection('transactions').add(transactionData);
                    setTransactions([...transactions, { id: docRef.id, ...transactionData }]);
                }
                
                setNewTransaction({ description: '', amount: '', category: '', date: '' });
                setShowTransactionForm(false);
            };

            const deleteTransaction = async (id) => {
                if (!confirm('Delete this transaction?')) return;
                await db.collection('transactions').doc(id).delete();
                setTransactions(transactions.filter(t => t.id !== id));
            };

            const updateBudget = async (category, amount) => {
                const budgetData = { category, amount: parseFloat(amount), monthYear: selectedMonth };
                const existing = budgets.find(b => b.category === category && b.monthYear === selectedMonth);
                
                if (existing) {
                    await db.collection('budgets').doc(existing.id).update(budgetData);
                    setBudgets(budgets.map(b => b.id === existing.id ? { ...b, ...budgetData } : b));
                } else {
                    const docRef = await db.collection('budgets').add(budgetData);
                    setBudgets([...budgets, { id: docRef.id, ...budgetData }]);
                }
            };

            const monthTransactions = transactions.filter(t => t.monthYear === selectedMonth);
            const filteredTransactions = monthTransactions.filter(t => {
                const matchesSearch = t.description.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = filterCategory === 'all' || t.category === filterCategory;
                return matchesSearch && matchesCategory;
            });

            const spendingByCategory = categories.reduce((acc, cat) => {
                acc[cat] = monthTransactions.filter(t => t.category === cat).reduce((sum, t) => sum + t.amount, 0);
                return acc;
            }, {});

            const monthBudgets = budgets.filter(b => b.monthYear === selectedMonth);

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            <svg className="w-12 h-12 text-emerald-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
                            </svg>
                            <span className="bg-gradient-to-r from-emerald-400 via-green-400 to-lime-400 bg-clip-text text-transparent drop-shadow-lg">
                                Budget & Transactions
                            </span>
                        </h1>
                    </div>

                    <div className="flex gap-4 items-center flex-wrap">
                        <input
                            type="month"
                            value={selectedMonth}
                            onChange={(e) => setSelectedMonth(e.target.value)}
                            className="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg"
                        />
                        <input
                            type="text"
                            placeholder="Search transactions..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            className="flex-1 px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg"
                        />
                        <select
                            value={filterCategory}
                            onChange={(e) => setFilterCategory(e.target.value)}
                            className="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg"
                        >
                            <option value="all">All Categories</option>
                            {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                        </select>
                    </div>

                    {/* Budget Overview */}
                    <div className="glass rounded-2xl p-6">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold">Monthly Budgets</h2>
                            <button
                                onClick={() => setShowBudgetForm(!showBudgetForm)}
                                className="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 rounded-lg text-sm"
                            >
                                {showBudgetForm ? 'Close' : 'Set Budgets'}
                            </button>
                        </div>

                        {showBudgetForm && (
                            <div className="mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                                {categories.map(cat => {
                                    const budget = monthBudgets.find(b => b.category === cat);
                                    return (
                                        <div key={cat} className="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg">
                                            <span className="text-2xl">{getCategoryIcon(cat)}</span>
                                            <span className="flex-1 font-medium">{cat}</span>
                                            <input
                                                type="number"
                                                placeholder="Budget"
                                                defaultValue={budget?.amount || ''}
                                                onBlur={(e) => e.target.value && updateBudget(cat, e.target.value)}
                                                className="w-32 px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm"
                                            />
                                        </div>
                                    );
                                })}
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {categories.map(cat => {
                                const spent = spendingByCategory[cat];
                                const budget = monthBudgets.find(b => b.category === cat);
                                const budgetAmount = budget?.amount || 0;
                                const percentage = budgetAmount > 0 ? (spent / budgetAmount * 100) : 0;
                                const isOverBudget = spent > budgetAmount && budgetAmount > 0;
                                
                                if (!budgetAmount && spent === 0) return null;
                                
                                return (
                                    <div key={cat} className="p-4 bg-gray-800/50 rounded-xl border border-gray-700">
                                        <div className="flex items-center gap-2 mb-2">
                                            <span className="text-xl">{getCategoryIcon(cat)}</span>
                                            <span className="font-medium text-sm">{cat}</span>
                                        </div>
                                        <div className="mb-2">
                                            <div className="flex justify-between text-sm mb-1">
                                                <span className={isOverBudget ? 'text-red-400' : 'text-emerald-400'}>
                                                    {formatCurrency(spent)}
                                                </span>
                                                <span className="text-gray-400">
                                                    {budgetAmount > 0 ? formatCurrency(budgetAmount) : 'No budget'}
                                                </span>
                                            </div>
                                            {budgetAmount > 0 && (
                                                <>
                                                    <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                                                        <div
                                                            className={`h-full ${isOverBudget ? 'bg-red-500' : 'bg-gradient-to-r from-emerald-500 to-green-500'}`}
                                                            style={{ width: `${Math.min(percentage, 100)}%` }}
                                                        ></div>
                                                    </div>
                                                    <p className="text-xs text-gray-400 mt-1">
                                                        {isOverBudget ? `Over by ${formatCurrency(spent - budgetAmount)}` : `${formatCurrency(budgetAmount - spent)} remaining`}
                                                    </p>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Add Transaction */}
                    <div className="flex gap-4">
                        <button
                            onClick={() => {
                                setShowTransactionForm(!showTransactionForm);
                                setEditingId(null);
                                setNewTransaction({ description: '', amount: '', category: '', date: new Date().toISOString().split('T')[0] });
                            }}
                            className="px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg"
                        >
                            {showTransactionForm ? 'Cancel' : '+ Add Transaction'}
                        </button>
                    </div>

                    {showTransactionForm && (
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">
                                {editingId ? 'Edit Transaction' : 'Add New Transaction'}
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <input
                                    type="text"
                                    placeholder="Description"
                                    value={newTransaction.description}
                                    onChange={(e) => setNewTransaction({...newTransaction, description: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                                <input
                                    type="number"
                                    step="0.01"
                                    placeholder="Amount"
                                    value={newTransaction.amount}
                                    onChange={(e) => setNewTransaction({...newTransaction, amount: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                                <select
                                    value={newTransaction.category}
                                    onChange={(e) => setNewTransaction({...newTransaction, category: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                >
                                    <option value="">Select Category</option>
                                    {categories.map(cat => (
                                        <option key={cat} value={cat}>{getCategoryIcon(cat)} {cat}</option>
                                    ))}
                                </select>
                                <input
                                    type="date"
                                    value={newTransaction.date}
                                    onChange={(e) => setNewTransaction({...newTransaction, date: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                            </div>
                            <button
                                onClick={addOrUpdateTransaction}
                                className="w-full mt-4 px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold"
                            >
                                {editingId ? 'Update Transaction' : 'Add Transaction'}
                            </button>
                        </div>
                    )}

                    {/* Transaction List */}
                    <div className="glass rounded-2xl p-6">
                        <h2 className="text-2xl font-bold mb-4">Transactions</h2>
                        <div className="space-y-2">
                            {filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date)).map(trans => (
                                <div key={trans.id} className="flex justify-between items-center p-4 bg-gray-800/50 rounded-lg hover:bg-gray-800 transition-all">
                                    <div className="flex items-center gap-4 flex-1">
                                        <span className="text-2xl">{getCategoryIcon(trans.category)}</span>
                                        <div className="flex-1">
                                            <p className="font-medium">{trans.description}</p>
                                            <p className="text-sm text-gray-400">{trans.category} ‚Ä¢ {formatDate(trans.date)}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <span className="font-bold text-lg text-red-400">{formatCurrency(trans.amount)}</span>
                                        <button
                                            onClick={() => {
                                                setNewTransaction({
                                                    description: trans.description,
                                                    amount: trans.amount.toString(),
                                                    category: trans.category,
                                                    date: trans.date
                                                });
                                                setEditingId(trans.id);
                                                setShowTransactionForm(true);
                                            }}
                                            className="text-blue-400 hover:text-blue-300 text-sm"
                                        >
                                            Edit
                                        </button>
                                        <button
                                            onClick={() => deleteTransaction(trans.id)}
                                            className="text-red-400 hover:text-red-300 text-sm"
                                        >
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            ))}
                            
                            {filteredTransactions.length === 0 && (
                                <div className="text-center py-12">
                                    <p className="text-gray-400">No transactions found</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ BILL PAYMENT TRACKER ============
        const BillPaymentTracker = ({ bills, billPayments, setBillPayments }) => {
            const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));

            const togglePayment = async (billId, isPaid) => {
                const monthYear = selectedMonth;
                const existing = billPayments.find(p => p.billId === billId && p.monthYear === monthYear);
                
                if (existing) {
                    await db.collection('billPayments').doc(existing.id).update({ isPaid, paidDate: isPaid ? new Date().toISOString() : null });
                    setBillPayments(billPayments.map(p => p.id === existing.id ? { ...p, isPaid, paidDate: isPaid ? new Date().toISOString() : null } : p));
                } else {
                    const paymentData = { billId, monthYear, isPaid, paidDate: isPaid ? new Date().toISOString() : null };
                    const docRef = await db.collection('billPayments').add(paymentData);
                    setBillPayments([...billPayments, { id: docRef.id, ...paymentData }]);
                }
            };

            const currentMonthPayments = billPayments.filter(p => p.monthYear === selectedMonth);
            const today = new Date().getDate();

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            <svg className="w-12 h-12 text-blue-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fillRule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clipRule="evenodd"/>
                            </svg>
                            <span className="bg-gradient-to-r from-blue-400 via-cyan-400 to-teal-400 bg-clip-text text-transparent drop-shadow-lg">
                                Bill Payment Tracker
                            </span>
                        </h1>
                    </div>

                    <div className="flex gap-4 items-center">
                        <label className="text-sm font-medium">Select Month:</label>
                        <input
                            type="month"
                            value={selectedMonth}
                            onChange={(e) => setSelectedMonth(e.target.value)}
                            className="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg"
                        />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="glass rounded-xl p-4">
                            <p className="text-sm text-gray-400 mb-1">Total Bills</p>
                            <p className="text-2xl font-bold">{bills.length}</p>
                        </div>
                        <div className="glass rounded-xl p-4">
                            <p className="text-sm text-gray-400 mb-1">Paid</p>
                            <p className="text-2xl font-bold text-emerald-400">
                                {currentMonthPayments.filter(p => p.isPaid).length}
                            </p>
                        </div>
                        <div className="glass rounded-xl p-4">
                            <p className="text-sm text-gray-400 mb-1">Pending</p>
                            <p className="text-2xl font-bold text-amber-400">
                                {bills.length - currentMonthPayments.filter(p => p.isPaid).length}
                            </p>
                        </div>
                    </div>

                    <div className="glass rounded-2xl p-6">
                        <h2 className="text-2xl font-bold mb-4">Payment Checklist</h2>
                        <div className="space-y-3">
                            {bills.sort((a, b) => a.dueDate - b.dueDate).map(bill => {
                                const payment = currentMonthPayments.find(p => p.billId === bill.id);
                                const isPaid = payment?.isPaid || false;
                                const isOverdue = !isPaid && today > bill.dueDate;
                                const isDueSoon = !isPaid && today <= bill.dueDate && (bill.dueDate - today) <= 3;

                                return (
                                    <div 
                                        key={bill.id}
                                        className={`p-4 rounded-xl border-2 transition-all ${
                                            isPaid ? 'border-emerald-500 bg-emerald-900/20' :
                                            isOverdue ? 'border-red-500 bg-red-900/20' :
                                            isDueSoon ? 'border-amber-500 bg-amber-900/20' :
                                            'border-gray-700 bg-gray-800/30'
                                        }`}
                                    >
                                        <div className="flex items-center gap-4">
                                            <input
                                                type="checkbox"
                                                checked={isPaid}
                                                onChange={(e) => togglePayment(bill.id, e.target.checked)}
                                                className="w-5 h-5 rounded border-gray-600 text-emerald-600 focus:ring-emerald-500 cursor-pointer"
                                            />
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2">
                                                    <p className={`font-semibold ${isPaid ? 'line-through text-gray-400' : ''}`}>
                                                        {bill.name}
                                                    </p>
                                                    {isOverdue && <span className="px-2 py-1 bg-red-600 rounded text-xs">OVERDUE</span>}
                                                    {isDueSoon && <span className="px-2 py-1 bg-amber-600 rounded text-xs">DUE SOON</span>}
                                                </div>
                                                <p className="text-sm text-gray-400">
                                                    Due: Day {bill.dueDate} ‚Ä¢ {formatCurrency(bill.amount)}
                                                    {payment?.paidDate && ` ‚Ä¢ Paid on ${formatDate(payment.paidDate.split('T')[0])}`}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ ANALYTICS & CHARTS ============
        const Analytics = ({ debts, transactions, income, bills, savings, netWorthHistory }) => {
            useEffect(() => {
                // Debt Progress Chart
                const debtCtx = document.getElementById('debtChart');
                if (debtCtx && debts.length > 0) {
                    new Chart(debtCtx, {
                        type: 'line',
                        data: {
                            labels: debts.map(d => d.name),
                            datasets: [{
                                label: 'Current Balance',
                                data: debts.map(d => d.balance),
                                borderColor: 'rgb(239, 68, 68)',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: { legend: { labels: { color: '#F9FAFB' } } },
                            scales: {
                                y: { ticks: { color: '#F9FAFB' }, grid: { color: 'rgba(249, 250, 251, 0.1)' } },
                                x: { ticks: { color: '#F9FAFB' }, grid: { color: 'rgba(249, 250, 251, 0.1)' } }
                            }
                        }
                    });
                }

                // Spending by Category Chart
                const categoryCtx = document.getElementById('categoryChart');
                if (categoryCtx && transactions.length > 0) {
                    const categoryData = transactions.reduce((acc, t) => {
                        acc[t.category] = (acc[t.category] || 0) + t.amount;
                        return acc;
                    }, {});

                    new Chart(categoryCtx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(categoryData),
                            datasets: [{
                                data: Object.values(categoryData),
                                backgroundColor: [
                                    'rgb(16, 185, 129)', 'rgb(59, 130, 246)', 'rgb(249, 115, 22)',
                                    'rgb(236, 72, 153)', 'rgb(139, 92, 246)', 'rgb(34, 197, 94)',
                                    'rgb(251, 146, 60)', 'rgb(168, 85, 247)', 'rgb(14, 165, 233)', 'rgb(132, 204, 22)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: { legend: { labels: { color: '#F9FAFB' } } }
                        }
                    });
                }

                // Net Worth Trend
                const netWorthCtx = document.getElementById('netWorthChart');
                if (netWorthCtx && netWorthHistory.length > 0) {
                    new Chart(netWorthCtx, {
                        type: 'line',
                        data: {
                            labels: netWorthHistory.map(h => h.date),
                            datasets: [{
                                label: 'Net Worth',
                                data: netWorthHistory.map(h => h.amount),
                                borderColor: 'rgb(16, 185, 129)',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: { legend: { labels: { color: '#F9FAFB' } } },
                            scales: {
                                y: { ticks: { color: '#F9FAFB' }, grid: { color: 'rgba(249, 250, 251, 0.1)' } },
                                x: { ticks: { color: '#F9FAFB' }, grid: { color: 'rgba(249, 250, 251, 0.1)' } }
                            }
                        }
                    });
                }
            }, [debts, transactions, netWorthHistory]);

            const totalIncome = income.reduce((sum, i) => sum + i.amount, 0);
            const totalBills = bills.reduce((sum, b) => sum + b.amount, 0);
            const monthTransactions = transactions.filter(t => t.monthYear === new Date().toISOString().slice(0, 7));
            const totalSpent = monthTransactions.reduce((sum, t) => sum + t.amount, 0);

            return (
                <div className="space-y-6">
                    <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                        <svg className="w-12 h-12 text-purple-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                        <span className="bg-gradient-to-r from-purple-400 via-violet-400 to-indigo-400 bg-clip-text text-transparent drop-shadow-lg">
                            Analytics
                        </span>
                    </h1>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="glass rounded-xl p-6">
                            <p className="text-sm text-gray-400 mb-2">Monthly Income</p>
                            <p className="text-3xl font-bold text-emerald-400">{formatCurrency(totalIncome)}</p>
                        </div>
                        <div className="glass rounded-xl p-6">
                            <p className="text-sm text-gray-400 mb-2">Monthly Expenses</p>
                            <p className="text-3xl font-bold text-red-400">{formatCurrency(totalBills + totalSpent)}</p>
                        </div>
                        <div className="glass rounded-xl p-6">
                            <p className="text-sm text-gray-400 mb-2">Net Savings</p>
                            <p className={`text-3xl font-bold ${totalIncome - (totalBills + totalSpent) >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                                {formatCurrency(totalIncome - (totalBills + totalSpent))}
                            </p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-xl font-bold mb-4">Debt Overview</h3>
                            <canvas id="debtChart"></canvas>
                        </div>
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-xl font-bold mb-4">Spending by Category</h3>
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>

                    <div className="glass rounded-2xl p-6">
                        <h3 className="text-xl font-bold mb-4">Net Worth Trend</h3>
                        <canvas id="netWorthChart"></canvas>
                    </div>
                </div>
            );
        };

        // ============ NET WORTH TRACKER ============
        const NetWorthTracker = ({ debts, savings, netWorthHistory, setNetWorthHistory }) => {
            const totalSavings = savings.reduce((sum, s) => sum + parseFloat(s.balance), 0);
            const totalDebt = debts.reduce((sum, d) => sum + d.balance, 0);
            const netWorth = totalSavings - totalDebt;

            const saveSnapshot = async () => {
                const snapshot = {
                    date: new Date().toISOString().split('T')[0],
                    amount: netWorth,
                    savings: totalSavings,
                    debts: totalDebt
                };
                const docRef = await db.collection('netWorthHistory').add(snapshot);
                setNetWorthHistory([...netWorthHistory, { id: docRef.id, ...snapshot }]);
            };

            const sortedHistory = [...netWorthHistory].sort((a, b) => new Date(b.date) - new Date(a.date));

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            <svg className="w-12 h-12 text-green-400 drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                            </svg>
                            <span className="bg-gradient-to-r from-green-400 via-emerald-400 to-teal-400 bg-clip-text text-transparent drop-shadow-lg">
                                Net Worth
                            </span>
                        </h1>
                        <button
                            onClick={saveSnapshot}
                            className="px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg"
                        >
                            Save Snapshot
                        </button>
                    </div>

                    <div className="glass rounded-2xl p-8 text-center">
                        <p className="text-xl text-gray-400 mb-2">Current Net Worth</p>
                        <p className={`text-6xl font-bold ${netWorth >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                            {formatCurrency(netWorth)}
                        </p>
                        <div className="mt-6 grid grid-cols-2 gap-4">
                            <div>
                                <p className="text-sm text-gray-400">Total Assets</p>
                                <p className="text-2xl font-bold text-emerald-400">{formatCurrency(totalSavings)}</p>
                            </div>
                            <div>
                                <p className="text-sm text-gray-400">Total Liabilities</p>
                                <p className="text-2xl font-bold text-red-400">{formatCurrency(totalDebt)}</p>
                            </div>
                        </div>
                    </div>

                    <div className="glass rounded-2xl p-6">
                        <h2 className="text-2xl font-bold mb-4">History</h2>
                        <div className="space-y-3">
                            {sortedHistory.map(snapshot => (
                                <div key={snapshot.id} className="flex justify-between items-center p-4 bg-gray-800/50 rounded-lg">
                                    <span className="font-medium">{formatDate(snapshot.date)}</span>
                                    <span className={`text-xl font-bold ${snapshot.amount >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                                        {formatCurrency(snapshot.amount)}
                                    </span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ WEDDING BUDGET ============
        const WeddingBudget = ({ weddingExpenses, setWeddingExpenses }) => {
            const [showForm, setShowForm] = useState(false);
            const [newExpense, setNewExpense] = useState({ category: '', item: '', budgeted: '', paid: '', vendor: '', notes: '' });
            const [editingId, setEditingId] = useState(null);

            const categories = ['Venue', 'Catering', 'Photography', 'Flowers', 'Music', 'Attire', 'Decorations', 'Other'];

            const addOrUpdateExpense = async () => {
                if (!newExpense.category || !newExpense.item || !newExpense.budgeted) return;
                
                const expenseData = {
                    category: newExpense.category,
                    item: newExpense.item,
                    budgeted: parseFloat(newExpense.budgeted),
                    paid: parseFloat(newExpense.paid) || 0,
                    vendor: newExpense.vendor,
                    notes: newExpense.notes
                };

                if (editingId) {
                    await db.collection('weddingExpenses').doc(editingId).update(expenseData);
                    setWeddingExpenses(weddingExpenses.map(e => e.id === editingId ? { ...e, ...expenseData } : e));
                    setEditingId(null);
                } else {
                    const docRef = await db.collection('weddingExpenses').add(expenseData);
                    setWeddingExpenses([...weddingExpenses, { id: docRef.id, ...expenseData }]);
                }
                
                setNewExpense({ category: '', item: '', budgeted: '', paid: '', vendor: '', notes: '' });
                setShowForm(false);
            };

            const deleteExpense = async (id) => {
                if (!confirm('Delete this expense?')) return;
                await db.collection('weddingExpenses').doc(id).delete();
                setWeddingExpenses(weddingExpenses.filter(e => e.id !== id));
            };

            const totalBudgeted = weddingExpenses.reduce((sum, e) => sum + e.budgeted, 0);
            const totalPaid = weddingExpenses.reduce((sum, e) => sum + e.paid, 0);
            const remaining = totalBudgeted - totalPaid;

            const byCategory = categories.reduce((acc, cat) => {
                acc[cat] = weddingExpenses.filter(e => e.category === cat);
                return acc;
            }, {});

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            <svg className="w-12 h-12 text-pink-400" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clipRule="evenodd"/>
                            </svg>
                            <span className="bg-gradient-to-r from-pink-400 via-rose-400 to-red-400 bg-clip-text text-transparent drop-shadow-lg">
                                Wedding Budget
                            </span>
                        </h1>
                        <button
                            onClick={() => {
                                setShowForm(!showForm);
                                setEditingId(null);
                                setNewExpense({ category: '', item: '', budgeted: '', paid: '', vendor: '', notes: '' });
                            }}
                            className="px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg"
                        >
                            {showForm ? 'Cancel' : '+ Add Expense'}
                        </button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="glass rounded-xl p-6">
                            <p className="text-sm text-gray-400 mb-2">Total Budget</p>
                            <p className="text-3xl font-bold text-emerald-400">{formatCurrency(totalBudgeted)}</p>
                        </div>
                        <div className="glass rounded-xl p-6">
                            <p className="text-sm text-gray-400 mb-2">Total Paid</p>
                            <p className="text-3xl font-bold text-amber-400">{formatCurrency(totalPaid)}</p>
                        </div>
                        <div className="glass rounded-xl p-6">
                            <p className="text-sm text-gray-400 mb-2">Remaining</p>
                            <p className="text-3xl font-bold text-blue-400">{formatCurrency(remaining)}</p>
                        </div>
                    </div>

                    {showForm && (
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">{editingId ? 'Edit Expense' : 'Add Wedding Expense'}</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <select
                                    value={newExpense.category}
                                    onChange={(e) => setNewExpense({...newExpense, category: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                >
                                    <option value="">Select Category</option>
                                    {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                </select>
                                <input
                                    type="text"
                                    placeholder="Item/Service"
                                    value={newExpense.item}
                                    onChange={(e) => setNewExpense({...newExpense, item: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                                <input
                                    type="number"
                                    placeholder="Budgeted Amount"
                                    value={newExpense.budgeted}
                                    onChange={(e) => setNewExpense({...newExpense, budgeted: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                                <input
                                    type="number"
                                    placeholder="Amount Paid"
                                    value={newExpense.paid}
                                    onChange={(e) => setNewExpense({...newExpense, paid: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                                <input
                                    type="text"
                                    placeholder="Vendor"
                                    value={newExpense.vendor}
                                    onChange={(e) => setNewExpense({...newExpense, vendor: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                                <input
                                    type="text"
                                    placeholder="Notes"
                                    value={newExpense.notes}
                                    onChange={(e) => setNewExpense({...newExpense, notes: e.target.value})}
                                    className="px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                            </div>
                            <button
                                onClick={addOrUpdateExpense}
                                className="w-full mt-4 px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold"
                            >
                                {editingId ? 'Update Expense' : 'Add Expense'}
                            </button>
                        </div>
                    )}

                    {categories.map(cat => {
                        const items = byCategory[cat];
                        if (!items || items.length === 0) return null;
                        const catBudget = items.reduce((sum, i) => sum + i.budgeted, 0);
                        const catPaid = items.reduce((sum, i) => sum + i.paid, 0);

                        return (
                            <div key={cat} className="glass rounded-2xl p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-xl font-bold">{cat}</h3>
                                    <div className="text-right">
                                        <p className="text-sm text-gray-400">Paid / Budget</p>
                                        <p className="font-bold">{formatCurrency(catPaid)} / {formatCurrency(catBudget)}</p>
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    {items.map(item => (
                                        <div key={item.id} className="p-4 bg-gray-800/50 rounded-lg">
                                            <div className="flex justify-between items-start">
                                                <div className="flex-1">
                                                    <p className="font-semibold">{item.item}</p>
                                                    {item.vendor && <p className="text-sm text-gray-400">Vendor: {item.vendor}</p>}
                                                    {item.notes && <p className="text-sm text-gray-400">{item.notes}</p>}
                                                    <div className="mt-2 flex gap-4 text-sm">
                                                        <span>Budget: {formatCurrency(item.budgeted)}</span>
                                                        <span>Paid: {formatCurrency(item.paid)}</span>
                                                        <span className={item.paid >= item.budgeted ? 'text-emerald-400' : 'text-amber-400'}>
                                                            Remaining: {formatCurrency(item.budgeted - item.paid)}
                                                        </span>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => {
                                                            setNewExpense({
                                                                category: item.category,
                                                                item: item.item,
                                                                budgeted: item.budgeted.toString(),
                                                                paid: item.paid.toString(),
                                                                vendor: item.vendor,
                                                                notes: item.notes
                                                            });
                                                            setEditingId(item.id);
                                                            setShowForm(true);
                                                        }}
                                                        className="text-blue-400 hover:text-blue-300 text-sm"
                                                    >
                                                        Edit
                                                    </button>
                                                    <button
                                                        onClick={() => deleteExpense(item.id)}
                                                        className="text-red-400 hover:text-red-300 text-sm"
                                                    >
                                                        Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };

        // ============ SHARED NOTES ============
        const SharedNotes = ({ notes, setNotes, currentUser }) => {
            const [showForm, setShowForm] = useState(false);
            const [newNote, setNewNote] = useState({ title: '', content: '' });

            const addNote = async () => {
                if (!newNote.title || !newNote.content) return;
                
                const noteData = {
                    title: newNote.title,
                    content: newNote.content,
                    author: currentUser.email,
                    createdAt: new Date().toISOString()
                };

                const docRef = await db.collection('notes').add(noteData);
                setNotes([...notes, { id: docRef.id, ...noteData }]);
                setNewNote({ title: '', content: '' });
                setShowForm(false);
            };

            const deleteNote = async (id) => {
                if (!confirm('Delete this note?')) return;
                await db.collection('notes').doc(id).delete();
                setNotes(notes.filter(n => n.id !== id));
            };

            return (
                <div className="space-y-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                            <svg className="w-12 h-12 text-yellow-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"/>
                                <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"/>
                            </svg>
                            <span className="bg-gradient-to-r from-yellow-400 via-amber-400 to-orange-400 bg-clip-text text-transparent drop-shadow-lg">
                                Shared Notes
                            </span>
                        </h1>
                        <button
                            onClick={() => setShowForm(!showForm)}
                            className="px-6 py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-700 hover:to-green-700 rounded-xl font-semibold shadow-lg"
                        >
                            {showForm ? 'Cancel' : '+ Add Note'}
                        </button>
                    </div>

                    {showForm && (
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-xl font-semibold mb-4">Add New Note</h3>
                            <div className="space-y-4">
                                <input
                                    type="text"
                                    placeholder="Title"
                                    value={newNote.title}
                                    onChange={(e) => setNewNote({...newNote, title: e.target.value})}
                                    className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg"
                                />
                                <textarea
                                    placeholder="What's on your mind?"
                                    value={newNote.content}
                                    onChange={(e) => setNewNote({...newNote, content: e.target.value})}
                                    rows="5"
                                    className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg resize-none"
                                />
                                <button
                                    onClick={addNote}
                                    className="w-full px-6 py-3 bg-green-600 hover:bg-green-700 rounded-lg font-semibold"
                                >
                                    Add Note
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="space-y-4">
                        {notes.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).map(note => (
                            <div key={note.id} className="glass rounded-2xl p-6">
                                <div className="flex justify-between items-start mb-3">
                                    <div className="flex-1">
                                        <h3 className="text-xl font-bold mb-1">{note.title}</h3>
                                        <p className="text-sm text-gray-400">
                                            by {note.author} ‚Ä¢ {formatDate(note.createdAt.split('T')[0])}
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => deleteNote(note.id)}
                                        className="text-red-400 hover:text-red-300 text-sm"
                                    >
                                        Delete
                                    </button>
                                </div>
                                <p className="text-gray-300 whitespace-pre-wrap">{note.content}</p>
                            </div>
                        ))}
                        {notes.length === 0 && (
                            <div className="glass rounded-2xl p-12 text-center">
                                <p className="text-gray-400">No notes yet. Start a conversation!</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ============ DEBT PAYOFF STRATEGIES ============
        const DebtStrategies = ({ debts, income, bills }) => {
            const monthlyIncome = income.reduce((sum, i) => sum + i.amount, 0);
            const monthlyBills = bills.reduce((sum, b) => sum + b.amount, 0);
            const minDebtPayments = debts.reduce((sum, d) => sum + (d.monthlyPayment || 0), 0);
            const availableExtra = monthlyIncome - monthlyBills - minDebtPayments;

            const calculateSnowball = () => {
                const sorted = [...debts].sort((a, b) => a.balance - b.balance);
                let months = 0;
                let remaining = availableExtra;
                let results = [];

                sorted.forEach(debt => {
                    const payment = (debt.monthlyPayment || 0) + (remaining > 0 ? remaining : 0);
                    const monthsToPayoff = Math.ceil(debt.balance / payment);
                    months += monthsToPayoff;
                    results.push({ ...debt, months: monthsToPayoff, strategy: 'Snowball' });
                    remaining = payment; // Snowball this payment to next debt
                });

                return { months, results };
            };

            const calculateAvalanche = () => {
                const sorted = [...debts].sort((a, b) => b.interestRate - a.interestRate);
                let months = 0;
                let remaining = availableExtra;
                let results = [];

                sorted.forEach(debt => {
                    const payment = (debt.monthlyPayment || 0) + (remaining > 0 ? remaining : 0);
                    const monthsToPayoff = Math.ceil(debt.balance / payment);
                    months += monthsToPayoff;
                    results.push({ ...debt, months: monthsToPayoff, strategy: 'Avalanche' });
                    remaining = payment;
                });

                return { months, results };
            };

            const snowball = calculateSnowball();
            const avalanche = calculateAvalanche();

            return (
                <div className="space-y-6">
                    <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold flex items-center gap-3">
                        <svg className="w-12 h-12 text-red-400 drop-shadow-lg" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clipRule="evenodd"/>
                        </svg>
                        <span className="bg-gradient-to-r from-red-400 via-orange-400 to-amber-400 bg-clip-text text-transparent drop-shadow-lg">
                            Debt Payoff Strategies
                        </span>
                    </h1>

                    <div className="glass rounded-2xl p-6">
                        <h3 className="text-xl font-bold mb-4">Available for Extra Payments</h3>
                        <p className={`text-4xl font-bold ${availableExtra >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                            {formatCurrency(Math.max(0, availableExtra))}
                        </p>
                        <p className="text-sm text-gray-400 mt-2">
                            Income ({formatCurrency(monthlyIncome)}) - Bills ({formatCurrency(monthlyBills)}) - Min Payments ({formatCurrency(minDebtPayments)})
                        </p>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Snowball Method */}
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-2xl font-bold mb-2">Snowball Method</h3>
                            <p className="text-sm text-gray-400 mb-4">Pay off smallest debts first for quick wins</p>
                            <div className="mb-4 p-4 bg-emerald-900/20 border border-emerald-500/50 rounded-xl">
                                <p className="text-sm text-gray-400">Total Time to Debt Free</p>
                                <p className="text-3xl font-bold text-emerald-400">
                                    {Math.floor(snowball.months / 12)} years {snowball.months % 12} months
                                </p>
                            </div>
                            <div className="space-y-2">
                                {snowball.results.map((debt, idx) => (
                                    <div key={debt.id} className="p-3 bg-gray-800/50 rounded-lg">
                                        <div className="flex justify-between items-center">
                                            <div>
                                                <span className="font-semibold">#{idx + 1} {debt.name}</span>
                                                <p className="text-sm text-gray-400">{formatCurrency(debt.balance)}</p>
                                            </div>
                                            <span className="text-emerald-400 font-bold">
                                                {debt.months} months
                                            </span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Avalanche Method */}
                        <div className="glass rounded-2xl p-6">
                            <h3 className="text-2xl font-bold mb-2">Avalanche Method</h3>
                            <p className="text-sm text-gray-400 mb-4">Pay off highest interest first to save money</p>
                            <div className="mb-4 p-4 bg-blue-900/20 border border-blue-500/50 rounded-xl">
                                <p className="text-sm text-gray-400">Total Time to Debt Free</p>
                                <p className="text-3xl font-bold text-blue-400">
                                    {Math.floor(avalanche.months / 12)} years {avalanche.months % 12} months
                                </p>
                            </div>
                            <div className="space-y-2">
                                {avalanche.results.map((debt, idx) => (
                                    <div key={debt.id} className="p-3 bg-gray-800/50 rounded-lg">
                                        <div className="flex justify-between items-center">
                                            <div>
                                                <span className="font-semibold">#{idx + 1} {debt.name}</span>
                                                <p className="text-sm text-gray-400">{formatCurrency(debt.balance)} @ {debt.interestRate}%</p>
                                            </div>
                                            <span className="text-blue-400 font-bold">
                                                {debt.months} months
                                            </span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="glass rounded-2xl p-6">
                        <h3 className="text-xl font-bold mb-4">Recommendation</h3>
                        <p className="text-gray-300">
                            {snowball.months < avalanche.months ? (
                                <span>The <span className="text-emerald-400 font-bold">Snowball Method</span> will get you debt-free faster with your current situation. Quick wins will keep you motivated!</span>
                            ) : snowball.months > avalanche.months ? (
                                <span>The <span className="text-blue-400 font-bold">Avalanche Method</span> will save you more money on interest. Stay disciplined for maximum savings!</span>
                            ) : (
                                <span>Both methods will take the same time. Choose <span className="text-emerald-400 font-bold">Snowball</span> for motivation or <span className="text-blue-400 font-bold">Avalanche</span> to minimize interest!</span>
                            )}
                        </p>
                    </div>
                </div>
            );
        };

        // ============ MAIN APP COMPONENT ============
        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            
            // Data states
            const [debts, setDebts] = useState([]);
            const [income, setIncome] = useState([]);
            const [bills, setBills] = useState([]);
            const [goals, setGoals] = useState([]);
            const [savings, setSavings] = useState([]);
            const [foodVotes, setFoodVotes] = useState([]);
            const [workoutVotes, setWorkoutVotes] = useState([]);
            const [transactions, setTransactions] = useState([]);
            const [budgets, setBudgets] = useState([]);
            const [extraPayments, setExtraPayments] = useState([]);
            const [billPayments, setBillPayments] = useState([]);
            const [weddingExpenses, setWeddingExpenses] = useState([]);
            const [notes, setNotes] = useState([]);
            const [netWorthHistory, setNetWorthHistory] = useState([]);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (user) => {
                    setUser(user);
                    if (user) {
                        // Load all data from Firestore
                        const [
                            debtsSnap, incomeSnap, billsSnap, goalsSnap, savingsSnap,
                            foodSnap, workoutSnap, transactionsSnap, budgetsSnap, extraSnap,
                            billPaymentsSnap, weddingSnap, notesSnap, netWorthSnap
                        ] = await Promise.all([
                            db.collection('debts').get(),
                            db.collection('income').get(),
                            db.collection('bills').get(),
                            db.collection('goals').get(),
                            db.collection('savings').get(),
                            db.collection('foodVotes').get(),
                            db.collection('workoutVotes').get(),
                            db.collection('transactions').get(),
                            db.collection('budgets').get(),
                            db.collection('extraPayments').get(),
                            db.collection('billPayments').get(),
                            db.collection('weddingExpenses').get(),
                            db.collection('notes').get(),
                            db.collection('netWorthHistory').get()
                        ]);

                        setDebts(debtsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setIncome(incomeSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setBills(billsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setGoals(goalsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setSavings(savingsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setFoodVotes(foodSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setWorkoutVotes(workoutSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setTransactions(transactionsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setBudgets(budgetsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setExtraPayments(extraSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setBillPayments(billPaymentsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setWeddingExpenses(weddingSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setNotes(notesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                        setNetWorthHistory(netWorthSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    }
                    setLoading(false);
                });

                return unsubscribe;
            }, []);

            // Notifications System
            useEffect(() => {
                if (!user || bills.length === 0) return;

                // Request notification permission
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }

                const checkNotifications = () => {
                    if (Notification.permission !== 'granted') return;

                    const today = new Date().getDate();
                    const currentMonth = new Date().toISOString().slice(0, 7);

                    // Check for upcoming bills (3 days or less)
                    const paidBills = billPayments.filter(p => p.monthYear === currentMonth && p.isPaid).map(p => p.billId);
                    const upcomingBills = bills.filter(bill => {
                        const daysUntilDue = bill.dueDate - today;
                        return daysUntilDue <= 3 && daysUntilDue >= 0 && !paidBills.includes(bill.id);
                    });

                    upcomingBills.forEach(bill => {
                        const daysUntilDue = bill.dueDate - today;
                        new Notification('Bill Due Soon! üìÖ', {
                            body: `${bill.name} is due in ${daysUntilDue} day${daysUntilDue !== 1 ? 's' : ''} (${formatCurrency(bill.amount)})`,
                            icon: '/favicon.ico'
                        });
                    });

                    // Check for overdue bills
                    const overdueBills = bills.filter(bill => {
                        return today > bill.dueDate && !paidBills.includes(bill.id);
                    });

                    overdueBills.forEach(bill => {
                        new Notification('Bill Overdue! ‚ö†Ô∏è', {
                            body: `${bill.name} is overdue! (${formatCurrency(bill.amount)})`,
                            icon: '/favicon.ico'
                        });
                    });

                    // Check for budget overages
                    const monthTransactions = transactions.filter(t => t.monthYear === currentMonth);
                    const monthBudgets = budgets.filter(b => b.monthYear === currentMonth);

                    monthBudgets.forEach(budget => {
                        const spent = monthTransactions
                            .filter(t => t.category === budget.category)
                            .reduce((sum, t) => sum + t.amount, 0);
                        
                        if (spent > budget.amount) {
                            new Notification(`Budget Alert: ${budget.category} üí∏`, {
                                body: `You've exceeded your budget by ${formatCurrency(spent - budget.amount)}`,
                                icon: '/favicon.ico'
                            });
                        } else if (spent / budget.amount >= 0.9) {
                            new Notification(`Budget Warning: ${budget.category} ‚ö°`, {
                                body: `90% of budget used (${formatCurrency(spent)} / ${formatCurrency(budget.amount)})`,
                                icon: '/favicon.ico'
                            });
                        }
                    });
                };

                // Check notifications once when data loads
                checkNotifications();

                // Check daily at midnight
                const now = new Date();
                const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                const msUntilMidnight = tomorrow - now;

                const timeout = setTimeout(() => {
                    checkNotifications();
                    // Set up daily interval
                    const dailyInterval = setInterval(checkNotifications, 24 * 60 * 60 * 1000);
                    return () => clearInterval(dailyInterval);
                }, msUntilMidnight);

                return () => clearTimeout(timeout);
            }, [user, bills, billPayments, transactions, budgets]);

            const handleLogout = async () => {
                await auth.signOut();
                setCurrentPage('dashboard');
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-900">
                        <div className="text-2xl text-blue-400">Loading...</div>
                    </div>
                );
            }

            if (!user) {
                return <Login onLogin={() => setLoading(false)} />;
            }

            const getNavIcon = (id) => {
                const icons = {
                    dashboard: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/></svg>,
                    analytics: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/></svg>,
                    budget: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/></svg>,
                    billtracker: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/><path fillRule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clipRule="evenodd"/></svg>,
                    savings: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/><path fillRule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clipRule="evenodd"/></svg>,
                    networth: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>,
                    debt: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"/><path fillRule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clipRule="evenodd"/></svg>,
                    strategies: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clipRule="evenodd"/></svg>,
                    income: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>,
                    goals: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clipRule="evenodd"/></svg>,
                    wedding: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clipRule="evenodd"/></svg>,
                    notes: <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"/><path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"/></svg>,
                    food: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>,
                    workout: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
                };
                return icons[id];
            };

            const navItems = [
                { id: 'dashboard', label: 'Dashboard' },
                { id: 'analytics', label: 'Analytics' },
                { id: 'budget', label: 'Budget & Transactions' },
                { id: 'billtracker', label: 'Bill Tracker' },
                { id: 'savings', label: 'Savings' },
                { id: 'networth', label: 'Net Worth' },
                { id: 'debt', label: 'Debt' },
                { id: 'strategies', label: 'Payoff Strategies' },
                { id: 'income', label: 'Income & Bills' },
                { id: 'goals', label: 'Goals' },
                { id: 'wedding', label: 'Wedding Budget' },
                { id: 'notes', label: 'Shared Notes' },
                { id: 'food', label: 'Food Voting' },
                { id: 'workout', label: 'Workout Voting' }
            ];

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* Mobile Menu Button */}
                    <button
                        onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                        className="lg:hidden fixed top-4 left-4 z-50 p-3 bg-gradient-to-r from-emerald-600 to-green-600 rounded-xl shadow-lg"
                    >
                        <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            {mobileMenuOpen ? (
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            ) : (
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                            )}
                        </svg>
                    </button>

                    {/* Mobile Overlay */}
                    {mobileMenuOpen && (
                        <div 
                            className="lg:hidden fixed inset-0 bg-black/50 z-30"
                            onClick={() => setMobileMenuOpen(false)}
                        ></div>
                    )}

                    {/* Sidebar */}
                    <div className={`
                        w-72 glass border-r border-gray-700/50 flex flex-col
                        fixed lg:relative inset-y-0 left-0 z-40
                        transform transition-transform duration-300 ease-in-out
                        ${mobileMenuOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}
                    `}>
                        <div className="p-6 border-b border-gray-700/50">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="p-3 bg-gradient-to-br from-emerald-500 to-green-600 rounded-xl">
                                    <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <h1 className="text-2xl font-bold bg-gradient-to-r from-emerald-400 to-green-400 bg-clip-text text-transparent">
                                        Finance
                                    </h1>
                                    <p className="text-sm text-gray-400">Tracker</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 p-3 bg-gray-800/50 rounded-xl">
                                <div className="w-8 h-8 rounded-full bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center text-sm font-bold">
                                    {user.email[0].toUpperCase()}
                                </div>
                                <div className="flex-1 min-w-0">
                                    <p className="text-sm font-medium truncate">{user.email.split('@')[0]}</p>
                                    <p className="text-xs text-gray-400 truncate">{user.email}</p>
                                </div>
                            </div>
                        </div>
                        
                        <nav className="flex-1 p-4 space-y-2 scrollbar-hide overflow-auto">
                            {navItems.map(item => (
                                <button
                                    key={item.id}
                                    onClick={() => {
                                        setCurrentPage(item.id);
                                        setMobileMenuOpen(false);
                                    }}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${
                                        currentPage === item.id
                                            ? 'bg-gradient-to-r from-emerald-600 to-green-600 text-white shadow-lg shadow-emerald-500/50 scale-105'
                                            : 'text-gray-200 hover:bg-gray-800/50 hover:text-white'
                                    }`}
                                >
                                    <span className={currentPage === item.id ? 'text-white' : 'text-emerald-400'}>
                                        {getNavIcon(item.id)}
                                    </span>
                                    <span className={`font-semibold ${currentPage === item.id ? 'text-white drop-shadow-md' : 'text-gray-100'}`}>
                                        {item.label}
                                    </span>
                                </button>
                            ))}
                        </nav>

                        <div className="p-4 border-t border-gray-700/50">
                            <button
                                onClick={handleLogout}
                                className="w-full px-4 py-3 bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-700 hover:to-rose-700 rounded-xl font-semibold shadow-lg flex items-center justify-center gap-2"
                            >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                </svg>
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 overflow-auto scrollbar-hide w-full">
                        <div className="p-4 md:p-6 lg:p-8 pt-20 lg:pt-8">
                            {currentPage === 'dashboard' && (
                                <Dashboard
                                    debts={debts}
                                    income={income}
                                    bills={bills}
                                    goals={goals}
                                    spending={transactions}
                                    savings={savings}
                                />
                            )}
                            {currentPage === 'analytics' && (
                                <Analytics
                                    debts={debts}
                                    transactions={transactions}
                                    income={income}
                                    bills={bills}
                                    savings={savings}
                                    netWorthHistory={netWorthHistory}
                                />
                            )}
                            {currentPage === 'budget' && (
                                <TransactionsBudget
                                    transactions={transactions}
                                    setTransactions={setTransactions}
                                    budgets={budgets}
                                    setBudgets={setBudgets}
                                />
                            )}
                            {currentPage === 'billtracker' && (
                                <BillPaymentTracker
                                    bills={bills}
                                    billPayments={billPayments}
                                    setBillPayments={setBillPayments}
                                />
                            )}
                            {currentPage === 'savings' && (
                                <SavingsAccounts
                                    savings={savings}
                                    setSavings={setSavings}
                                />
                            )}
                            {currentPage === 'networth' && (
                                <NetWorthTracker
                                    debts={debts}
                                    savings={savings}
                                    netWorthHistory={netWorthHistory}
                                    setNetWorthHistory={setNetWorthHistory}
                                />
                            )}
                            {currentPage === 'debt' && (
                                <DebtManager
                                    debts={debts}
                                    setDebts={setDebts}
                                    extraPayments={extraPayments}
                                    setExtraPayments={setExtraPayments}
                                />
                            )}
                            {currentPage === 'strategies' && (
                                <DebtStrategies
                                    debts={debts}
                                    income={income}
                                    bills={bills}
                                />
                            )}
                            {currentPage === 'income' && (
                                <IncomeBills
                                    income={income}
                                    setIncome={setIncome}
                                    bills={bills}
                                    setBills={setBills}
                                />
                            )}
                            {currentPage === 'goals' && (
                                <Goals goals={goals} setGoals={setGoals} />
                            )}
                            {currentPage === 'wedding' && (
                                <WeddingBudget
                                    weddingExpenses={weddingExpenses}
                                    setWeddingExpenses={setWeddingExpenses}
                                />
                            )}
                            {currentPage === 'notes' && (
                                <SharedNotes
                                    notes={notes}
                                    setNotes={setNotes}
                                    currentUser={user}
                                />
                            )}
                            {currentPage === 'food' && (
                                <VotingPage
                                    title="Food Voting"
                                    votes={foodVotes}
                                    setVotes={setFoodVotes}
                                    collectionName="foodVotes"
                                    currentUser={user}
                                />
                            )}
                            {currentPage === 'workout' && (
                                <VotingPage
                                    title="Workout Voting"
                                    votes={workoutVotes}
                                    setVotes={setWorkoutVotes}
                                    collectionName="workoutVotes"
                                    currentUser={user}
                                />
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ RENDER APP ============
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

